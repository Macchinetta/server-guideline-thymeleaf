<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>4.5. ページネーション &#8212; Macchinetta Server Framework (1.x) Development Guideline 1.8.2.RELEASE documentation</title>
    
    <link rel="stylesheet" href="../../_static/solar.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.8.2.RELEASE',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="4.6. 二重送信防止" href="DoubleSubmitProtection.html" />
    <link rel="prev" title="4.4. セッション管理" href="SessionManagement.html" /><script src="../../_static/jquery.treeview.js" type="text/javascript"></script>
<!-- <link href='http://fonts.googleapis.com/css?family=Source+Code+Pro|Open+Sans:300italic,400italic,700italic,400,300,700' rel='stylesheet' type='text/css'> -->
<link href="../../_static/solarized-dark.css" rel="stylesheet">
<link href="../../_static/jquery.treeview.css" rel="stylesheet">
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="DoubleSubmitProtection.html" title="4.6. 二重送信防止"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="SessionManagement.html" title="4.4. セッション管理"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Macchinetta Server Framework (1.x) Development Guideline 1.8.2.RELEASE documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">4. Webアプリ開発機能</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><label><input id="scroll" type="checkbox"> scroll sidebar</label>

  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">4.5. ページネーション</a><ul>
<li><a class="reference internal" href="#overview">4.5.1. Overview</a><ul>
<li><a class="reference internal" href="#pagination-overview-page">4.5.1.1. ページ分割時の一覧画面の表示について</a></li>
<li><a class="reference internal" href="#pagination-overview-page-search">4.5.1.2. ページ検索について</a><ul>
<li><a class="reference internal" href="#spring-data">4.5.1.2.1. Spring Data提供のページ検索機能について</a></li>
</ul>
</li>
<li><a class="reference internal" href="#pagination-overview-page-display">4.5.1.3. ページネーションの表示について</a><ul>
<li><a class="reference internal" href="#pagination-overview-page-display-fetcheddata">4.5.1.3.1. 取得データの表示について</a></li>
<li><a class="reference internal" href="#pagination-overview-page-display-paginationlink">4.5.1.3.2. ページネーションリンクの表示について</a><ul>
<li><a class="reference internal" href="#pagination-overview-page-display-paginationlink-structure">4.5.1.3.2.1. ページネーションリンクの構成</a></li>
<li><a class="reference internal" href="#html">4.5.1.3.2.2. ページネーションリンクのHTML構造</a></li>
</ul>
</li>
<li><a class="reference internal" href="#pagination-overview-page-display-paginationinfo">4.5.1.3.3. ページネーション情報の表示について</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id10">4.5.1.4. ページネーション機能使用時の処理フロー</a></li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-use">4.5.2. How to use</a><ul>
<li><a class="reference internal" href="#id11">4.5.2.1. アプリケーションの設定</a><ul>
<li><a class="reference internal" href="#id12">4.5.2.1.1. Spring Dataのページネーション機能を有効化するための設定</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id13">4.5.2.2. ページ検索の実装</a><ul>
<li><a class="reference internal" href="#pagination-how-to-use-page-search-impl-app">4.5.2.2.1. アプリケーション層の実装</a></li>
<li><a class="reference internal" href="#mybatis3">4.5.2.2.2. ドメイン層の実装(MyBatis3編)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id15">4.5.2.3. テンプレートHTMLの実装</a><ul>
<li><a class="reference internal" href="#id16">4.5.2.3.1. 取得データの表示</a></li>
<li><a class="reference internal" href="#pagination-how-to-use-make-jsp-basic-paginationlink">4.5.2.3.2. ページネーションリンクの表示</a><ul>
<li><a class="reference internal" href="#pagination-how-to-use-make-jsp-basic-paginationlink-link-expressionobject">4.5.2.3.2.1. リンクの出力範囲を計算する式オブジェクトを実装する</a></li>
<li><a class="reference internal" href="#html-html">4.5.2.3.2.2. テンプレートHTML（フラグメント）にページネーションリンクのHTMLを実装する</a></li>
<li><a class="reference internal" href="#pagination-how-to-use-make-jsp-basic-paginationlink-impl-usefragment">4.5.2.3.2.3. テンプレートHTML（ページネーションを行う画面）にフラグメントを利用してページネーションリンクを表示する</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id20">4.5.2.3.3. ページネーション情報の表示</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#appendix">4.5.3. Appendix</a><ul>
<li><a class="reference internal" href="#pageablehandlermethodargumentresolver">4.5.3.1. <code class="docutils literal"><span class="pre">PageableHandlerMethodArgumentResolver</span></code> のプロパティ値について</a></li>
<li><a class="reference internal" href="#sorthandlermethodargumentresolver">4.5.3.2. <code class="docutils literal"><span class="pre">SortHandlerMethodArgumentResolver</span></code> のプロパティ値について</a></li>
</ul>
</li>
</ul>
</li>
</ul>


  <h4>Previous topic</h4>
  <p class="topless"><a href="SessionManagement.html"
                        title="previous chapter">4.4. セッション管理</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="DoubleSubmitProtection.html"
                        title="next chapter">4.6. 二重送信防止</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/ArchitectureInDetail/WebApplicationDetail/Pagination.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="id1">
<h1>4.5. ページネーション<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="id2">
<p class="topic-title first">目次</p>
<ul class="simple">
<li><a class="reference internal" href="#overview" id="id21">Overview</a><ul>
<li><a class="reference internal" href="#pagination-overview-page" id="id22">ページ分割時の一覧画面の表示について</a></li>
<li><a class="reference internal" href="#pagination-overview-page-search" id="id23">ページ検索について</a><ul>
<li><a class="reference internal" href="#spring-data" id="id24">Spring Data提供のページ検索機能について</a></li>
</ul>
</li>
<li><a class="reference internal" href="#pagination-overview-page-display" id="id25">ページネーションの表示について</a><ul>
<li><a class="reference internal" href="#pagination-overview-page-display-fetcheddata" id="id26">取得データの表示について</a></li>
<li><a class="reference internal" href="#pagination-overview-page-display-paginationlink" id="id27">ページネーションリンクの表示について</a></li>
<li><a class="reference internal" href="#pagination-overview-page-display-paginationinfo" id="id28">ページネーション情報の表示について</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id10" id="id29">ページネーション機能使用時の処理フロー</a></li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-use" id="id30">How to use</a><ul>
<li><a class="reference internal" href="#id11" id="id31">アプリケーションの設定</a><ul>
<li><a class="reference internal" href="#id12" id="id32">Spring Dataのページネーション機能を有効化するための設定</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id13" id="id33">ページ検索の実装</a><ul>
<li><a class="reference internal" href="#pagination-how-to-use-page-search-impl-app" id="id34">アプリケーション層の実装</a></li>
<li><a class="reference internal" href="#mybatis3" id="id35">ドメイン層の実装(MyBatis3編)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id15" id="id36">テンプレートHTMLの実装</a><ul>
<li><a class="reference internal" href="#id16" id="id37">取得データの表示</a></li>
<li><a class="reference internal" href="#pagination-how-to-use-make-jsp-basic-paginationlink" id="id38">ページネーションリンクの表示</a></li>
<li><a class="reference internal" href="#id20" id="id39">ページネーション情報の表示</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#appendix" id="id40">Appendix</a><ul>
<li><a class="reference internal" href="#pageablehandlermethodargumentresolver" id="id41"><code class="docutils literal"><span class="pre">PageableHandlerMethodArgumentResolver</span></code> のプロパティ値について</a></li>
<li><a class="reference internal" href="#sorthandlermethodargumentresolver" id="id42"><code class="docutils literal"><span class="pre">SortHandlerMethodArgumentResolver</span></code> のプロパティ値について</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="overview">
<h2><a class="toc-backref" href="#id21">4.5.1. Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>本章では、検索条件に一致するデータをページ分割して表示する方法(ページネーション)について説明する。</p>
<div class="line-block">
<div class="line"><strong>検索条件に一致するデータが大量になる場合は、ページネーション機能を使用することを推奨する。</strong></div>
<div class="line">一度に大量のデータを取得し画面に表示すると、以下3点の問題が発生する可能性がある。</div>
</div>
<ul>
<li><div class="first line-block">
<div class="line">サーバ側のメモリ枯渇の発生。</div>
<div class="line">単発のリクエストで問題が発生しなくても、同時に複数実行された場合に <code class="docutils literal"><span class="pre">java.lang.OutOfMemoryError</span></code> が発生する可能性がある。</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">ネットワーク負荷の発生。</div>
<div class="line">不要なデータがネットワークに流れることで、ネットワーク全体にかかる負荷が高くなり、システム全体のレスポンスタイムに影響を与える可能性がある。</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">画面のレスポンス遅延の発生。</div>
<div class="line">大量のデータを扱う場合、サーバの処理、ネットワークのトラフィック処理、クライアントの描画処理の全てで時間がかかるため、画面のレスポンスが遅くなる可能性がある。</div>
</div>
</li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="pagination-overview-page">
<span id="id3"></span><h3><a class="toc-backref" href="#id22">4.5.1.1. ページ分割時の一覧画面の表示について</a><a class="headerlink" href="#pagination-overview-page" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">ページネーション機能を利用してページ分割した場合、以下のような画面になる。</div>
<div class="line">各要素の表示にはサーバ側で行う検索処理をページ検索に対応させる必要がある。ページ検索機能については、「<a class="reference internal" href="#pagination-overview-page-search"><span class="std std-ref">ページ検索について</span></a> 」を参照されたい。</div>
<div class="line">また、各要素の概要及びHTML構造等については、「<a class="reference internal" href="#pagination-overview-page-display"><span class="std std-ref">ページネーションの表示について</span></a>」を参照されたい。</div>
</div>
<blockquote>
<div><div class="figure">
<a class="reference internal image-reference" href="../../_images/pagination-overview_screen.png"><img alt="Screen image of Pagination." src="../../_images/pagination-overview_screen.png" style="width: 100%;" /></a>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">ページ検索処理で取得したデータを表示する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">ページを移動するためのリンクを表示する。</div>
<div class="line">リンク押下時には、該当ページを表示するためのリクエストを送信する。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">ページネーションに関連する情報(合計件数、合計ページ数、表示ページ数など)を表示する。</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="pagination-overview-page-search">
<span id="id4"></span><h3><a class="toc-backref" href="#id23">4.5.1.2. ページ検索について</a><a class="headerlink" href="#pagination-overview-page-search" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">ページネーションを実現する際には、まずサーバ側で行う検索処理をページ検索できるように実装する必要がある。</div>
<div class="line">本ガイドラインでは、サーバ側のページ検索は、 Spring Data から提供されている仕組みを利用することを前提としている。</div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="spring-data">
<span id="pagination-overview-page-springdata"></span><h4><a class="toc-backref" href="#id24">4.5.1.2.1. Spring Data提供のページ検索機能について</a><a class="headerlink" href="#spring-data" title="Permalink to this headline">¶</a></h4>
<p>Spring Dataより提供されているページ検索用の機能は、以下の通り。</p>
<blockquote>
<div><table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1</td>
<td><div class="first last line-block">
<div class="line">リクエストパラメータよりページ検索に必要な情報(検索対象のページ位置、取得件数、ソート条件)を抽出し、抽出した情報を <code class="docutils literal"><span class="pre">org.springframework.data.domain.Pageable</span></code> のオブジェクトとしてControllerの引数に引き渡す。</div>
<div class="line">この機能は、 <code class="docutils literal"><span class="pre">org.springframework.data.web.PageableHandlerMethodArgumentResolver</span></code> クラスとして提供されており、 <code class="file docutils literal"><span class="pre">spring-mvc.xml</span></code> の <code class="docutils literal"><span class="pre">&lt;mvc:argument-resolvers&gt;</span></code> 要素に追加することで有効となる。</div>
<div class="line">リクエストパラメータについては、「 <a class="reference internal" href="#pagination-overview-pagesearch-requestparameter"><span class="std std-ref">Note欄</span></a> 」を参照されたい。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td>2</td>
<td><div class="first last line-block">
<div class="line">ページ情報(合計件数、該当ページのデータ、検索対象のページ位置、取得件数、ソート条件)を保持する。</div>
<div class="line">この機能は、 <code class="docutils literal"><span class="pre">org.springframework.data.domain.Page</span></code> インタフェースとして提供されており、デフォルトの実装クラスとして <code class="docutils literal"><span class="pre">org.springframework.data.domain.PageImpl</span></code> が提供されている。</div>
<div class="line">ページネーションリンクを出力する際には、 <code class="docutils literal"><span class="pre">Page</span></code> オブジェクトから必要なデータを取得する。</div>
</div>
</td>
</tr>
<tr class="row-even"><td>3</td>
<td><div class="first last line-block">
<div class="line">データベースアクセスとしてSpring Data JPAを使用する場合は、RepositoryのQueryメソッドの引数に <code class="docutils literal"><span class="pre">Pageable</span></code> オブジェクトを指定することで、該当ページの情報が <code class="docutils literal"><span class="pre">Page</span></code> オブジェクトとして返却される。</div>
<div class="line">合計件数を取得するSQLの発行、ソート条件の追加、該当ページに一致するデータの抽出などの処理が全て自動で行われる。</div>
<div class="line">データベースアクセスとして、MyBatisを使用する場合は、Spring Data JPAが自動で行ってくれる処理を、Java(Service)及びSQLマッピングファイル内で実装する必要がある。</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<blockquote id="pagination-overview-pagesearch-requestparameter">
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>ページ検索用のリクエストパラメータについて</strong></p>
<p>Spring Dataより提供されているページ検索用のリクエストパラメータは以下の3つとなる。</p>
<blockquote class="last">
<div><table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="15%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">パラメータ名</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td>page</td>
<td><div class="first last line-block">
<div class="line">検索対象のページ位置を指定するためのリクエストパラメータ。</div>
<div class="line">値には、0以上の数値を指定する。</div>
<div class="line">デフォルトの設定では、ページ位置の値は <code class="docutils literal"><span class="pre">0</span></code> から開始する。そのため、1ページ目のデータを取得する場合は <code class="docutils literal"><span class="pre">0</span></code> を、2ページ目のデータを取得する場合は <code class="docutils literal"><span class="pre">1</span></code> を指定する必要がある。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td>size</td>
<td><div class="first last line-block">
<div class="line">取得する件数を指定するためのリクエストパラメータ。</div>
<div class="line">値には、1以上の数値を指定する。</div>
<div class="line"><code class="docutils literal"><span class="pre">PageableHandlerMethodArgumentResolver</span></code> の <code class="docutils literal"><span class="pre">maxPageSize</span></code> に指定された値より大きい値が指定された場合は、 <code class="docutils literal"><span class="pre">maxPageSize</span></code> の値が <code class="docutils literal"><span class="pre">size</span></code> の値となる。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td>sort</td>
<td><div class="first last line-block">
<div class="line">ソート条件を指定するためのパラメータ(複数指定可能)。</div>
<div class="line">値には、<code class="docutils literal"><span class="pre">{ソート項目名(,ソート順)}</span></code> の形式で指定する。</div>
<div class="line">ソート順には、<code class="docutils literal"><span class="pre">ASC</span></code> 又は <code class="docutils literal"><span class="pre">DESC</span></code> のどちらかの値を指定し、省略した場合は <code class="docutils literal"><span class="pre">ASC</span></code> が適用される。</div>
<div class="line">項目名は “<code class="docutils literal"><span class="pre">,</span></code>” 区切りで複数指定することが可能である。</div>
<div class="line">例えば、クエリ文字列として <code class="docutils literal"><span class="pre">sort=lastModifiedDate,id,DESC&amp;sort=subId</span></code> が指定された場合、 <code class="docutils literal"><span class="pre">ORDER</span> <span class="pre">BY</span> <span class="pre">lastModifiedDate</span> <span class="pre">DESC,</span> <span class="pre">id</span> <span class="pre">DESC,</span> <span class="pre">subId</span> <span class="pre">ASC</span></code> のようなOrder By句をQueryに追加することになる。</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="pagination-overview-page-display">
<span id="id5"></span><h3><a class="toc-backref" href="#id25">4.5.1.3. ページネーションの表示について</a><a class="headerlink" href="#pagination-overview-page-display" title="Permalink to this headline">¶</a></h3>
<p>「<a class="reference internal" href="#pagination-overview-page"><span class="std std-ref">ページ分割時の一覧画面の表示について</span></a>」にて説明した画面の各要素について説明する。</p>
<div class="section" id="pagination-overview-page-display-fetcheddata">
<span id="id6"></span><h4><a class="toc-backref" href="#id26">4.5.1.3.1. 取得データの表示について</a><a class="headerlink" href="#pagination-overview-page-display-fetcheddata" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">ページ検索処理で検索条件(検索対象のページ位置、取得件数、ソート条件等)を指定して取得したデータを表示する。</div>
<div class="line">ページ検索については、「<a class="reference internal" href="#pagination-overview-page-search"><span class="std std-ref">ページ検索について</span></a> 」を参照されたい。</div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="pagination-overview-page-display-paginationlink">
<span id="id7"></span><h4><a class="toc-backref" href="#id27">4.5.1.3.2. ページネーションリンクの表示について</a><a class="headerlink" href="#pagination-overview-page-display-paginationlink" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">この章で実装例として取り上げるページネーションリンクについて以下の流れで説明する。</div>
</div>
<ol class="arabic simple">
<li><a class="reference internal" href="#pagination-overview-page-display-paginationlink-structure"><span class="std std-ref">ページネーションリンクの構成</span></a></li>
<li><a class="reference internal" href="#pagination-overview-page-display-paginationlink-htmlstructure"><span class="std std-ref">ページネーションリンクのHTML構造</span></a></li>
</ol>
<div class="line-block">
<div class="line">なおこの章では、TERASOLUNA共通ライブラリで提供されるJSPタグである <code class="docutils literal"><span class="pre">&lt;t:pagination&gt;</span></code> のデフォルト設定で出力されるHTMLを例に、ページネーションリンクの実装例を説明する。</div>
<div class="line">実装例のページネーションリンクの構成・レイアウト等は、あくまでも一例である。実装例を参考にアプリケーションの要件によって適宜変更すること。</div>
<div class="line"><br /></div>
<div class="line">以降の説明で使用する画面は、Bootstrap v3.0.0のスタイルシートを適用している。</div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="pagination-overview-page-display-paginationlink-structure">
<span id="id8"></span><h5>4.5.1.3.2.1. ページネーションリンクの構成<a class="headerlink" href="#pagination-overview-page-display-paginationlink-structure" title="Permalink to this headline">¶</a></h5>
<p>ページネーションリンクは、以下の要素から構成される。</p>
<blockquote>
<div><div class="figure align-center">
<a class="reference internal image-reference" href="../../_images/pagination-how_to_use_jsp_pagelink_description.png"><img alt="Structure of the pagination link." src="../../_images/pagination-how_to_use_jsp_pagelink_description.png" style="width: 90%;" /></a>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">最初のページに移動するためのリンク。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">前のページに移動するためのリンク。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">指定したページに移動するためのリンク。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">次のページに移動するためのリンク。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">最後のページに移動するためのリンク。</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>ページネーションリンクは、以下の状態をもつ。</p>
<blockquote>
<div><div class="figure align-center">
<a class="reference internal image-reference" href="../../_images/pagination-how_to_use_jsp_pagelink_description_status.png"><img alt="Status of the pagination link." src="../../_images/pagination-how_to_use_jsp_pagelink_description_status.png" style="width: 90%;" /></a>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">現在表示しているページで操作することができないリンクであることを示す状態。</div>
<div class="line">具体的には、1ページ目を表示している時の「最初のページに移動するためのリンク」「前のページに移動するためのリンク」と、最終ページを表示している時の「次のページに移動するためのリンク」「最後のページに移動するためのリンク」がこの状態となる。</div>
<div class="line">この状態を <code class="docutils literal"><span class="pre">disabled</span></code> と定義する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">現在表示しているページであることを示す状態。</div>
<div class="line">この状態を <code class="docutils literal"><span class="pre">active</span></code> と定義する。</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line">上記を実現するHTMLは、以下の構造となる。</div>
<div class="line">図中の番号は、上記で説明した「ページネーションリンクの構成」と「ページネーションリンクの状態」の項番に対応させている。</div>
</div>
<blockquote>
<div><div class="figure align-center">
<a class="reference internal image-reference" href="../../_images/pagination-overview_html.png"><img alt="html of the pagination link." src="../../_images/pagination-overview_html.png" style="width: 90%;" /></a>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="html">
<span id="pagination-overview-page-display-paginationlink-htmlstructure"></span><h5>4.5.1.3.2.2. ページネーションリンクのHTML構造<a class="headerlink" href="#html" title="Permalink to this headline">¶</a></h5>
<div class="line-block">
<div class="line">ページネーションリンクのHTML構造について説明する。</div>
<div class="line">スタイルクラスの指定は省略している。スタイルクラスは、作成するアプリケーションの要件に応じて適宜指定すること。</div>
</div>
<ul class="simple">
<li>HTML</li>
</ul>
<blockquote>
<div><div class="figure align-center">
<a class="reference internal image-reference" href="../../_images/pagination-overview_html_basic.png"><img alt="html structure of the pagination link." src="../../_images/pagination-overview_html_basic.png" style="width: 80%;" /></a>
</div>
</div></blockquote>
<ul class="simple">
<li>画面イメージ</li>
</ul>
<blockquote>
<div><div class="figure align-center">
<a class="reference internal image-reference" href="../../_images/pagination-overview_html_basic_screen.png"><img alt="screen structure of the pagination link." src="../../_images/pagination-overview_html_basic_screen.png" style="width: 80%;" /></a>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">ページネーションリンクの構成要素をまとめるための要素。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">ページネーションリンクを構成するための要素。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">ページ移動するためのリクエストを送信するための要素。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">ページ移動するためのURLを指定するための属性。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">ページ移動するためのリンクの表示テキストを指定する。</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="pagination-overview-page-display-paginationinfo">
<span id="id9"></span><h4><a class="toc-backref" href="#id28">4.5.1.3.3. ページネーション情報の表示について</a><a class="headerlink" href="#pagination-overview-page-display-paginationinfo" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">ページネーションに関する情報の表示を行う。</div>
<div class="line">Spring Data提供のページ検索機能を使用することで、以下の情報を画面に表示することができる。</div>
</div>
<ul class="simple">
<li>合計件数</li>
<li>検索対象のページ位置</li>
<li>取得件数</li>
<li>ソート条件</li>
</ul>
<div class="line-block">
<div class="line">ページ検索については、「<a class="reference internal" href="#pagination-overview-page-search"><span class="std std-ref">ページ検索について</span></a> 」を参照されたい。</div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="id10">
<h3><a class="toc-backref" href="#id29">4.5.1.4. ページネーション機能使用時の処理フロー</a><a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<p>Spring Dataより提供されているページネーション機能を利用した際の処理フローは、以下の通り。</p>
<blockquote>
<div><div class="figure">
<a class="reference internal image-reference" href="../../_images/pagination-overview_flow.png"><img alt="processing flow of pagination" src="../../_images/pagination-overview_flow.png" style="width: 100%;" /></a>
</div>
<table border="1" class="colwidths-given longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">検索条件と共に、リクエストパラメータとして検索対象のページ位置(page)と取得件数(size)を指定してリクエストを送信する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">PageableHandlerMethodArgumentResolver</span></code> は、リクエストパラメータに指定されている検索対象のページ位置(page)と取得件数(size)を取得し、 <code class="docutils literal"><span class="pre">Pageable</span></code> オブジェクトを生成する。</div>
<div class="line">生成された <code class="docutils literal"><span class="pre">Pageable</span></code> オブジェクトは、Controllerのハンドラメソッドの引数に設定される。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Controllerは、引数で受け取った <code class="docutils literal"><span class="pre">Pageable</span></code> オブジェクトを、Serviceのメソッドに引き渡す。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Serviceは、引数で受け取った <code class="docutils literal"><span class="pre">Pageable</span></code> オブジェクトを、 RepositoryのQueryメソッドに引き渡す。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Repositoryは、検索条件に一致するデータの合計件数(totalElements)と、引数で受け取った <code class="docutils literal"><span class="pre">Pageable</span></code> オブジェクトに指定されているページ位置(page)と取得件数(size)の範囲に存在するデータを、データベースより取得する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Repositoryは、取得した合計件数(totalElements)、取得データ(content)、引数で受け取った <code class="docutils literal"><span class="pre">Pageable</span></code> オブジェクトより <code class="docutils literal"><span class="pre">Page</span></code> オブジェクトを作成し、Service及びControllerへ返却する。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Controllerは、返却された <code class="docutils literal"><span class="pre">Page</span></code> オブジェクトを、 <code class="docutils literal"><span class="pre">Model</span></code> オブジェクトに格納後、ThymeleafのテンプレートHTMLに遷移する。</div>
<div class="line">テンプレートHTMLは、 <code class="docutils literal"><span class="pre">Model</span></code> オブジェクトに格納されている <code class="docutils literal"><span class="pre">Page</span></code> オブジェクトを取得し、ページネーションリンクを生成する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(8)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">生成したHTMLを、クライアント(ブラウザ)に返却する。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(9)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">ページネーションリンクを押下すると、該当ページを表示するためリクエストが送信される。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Repositoryの実装について</strong></p>
<p>上記フローの(5)と(6)の具体的な実装例については、</p>
<ul class="simple">
<li><a class="reference internal" href="../DataAccessDetail/DataAccessMyBatis3.html"><span class="doc">データベースアクセス（MyBatis3編）</span></a></li>
</ul>
<p class="last">を参照されたい。</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="how-to-use">
<h2><a class="toc-backref" href="#id30">4.5.2. How to use</a><a class="headerlink" href="#how-to-use" title="Permalink to this headline">¶</a></h2>
<p>ページネーション機能の具体的な使用方法を以下に示す。</p>
<div class="section" id="id11">
<h3><a class="toc-backref" href="#id31">4.5.2.1. アプリケーションの設定</a><a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id12">
<h4><a class="toc-backref" href="#id32">4.5.2.1.1. Spring Dataのページネーション機能を有効化するための設定</a><a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">リクエストパラメータに指定された検索対象のページ位置(page)、取得件数(size)、ソート条件(sort)を、 <code class="docutils literal"><span class="pre">Pageable</span></code> オブジェクトとしてControllerの引数に設定するための機能を有効化する。</div>
<div class="line">下記の設定は、ブランクプロジェクトでは設定済みの状態になっている。</div>
</div>
<p><code class="file docutils literal"><span class="pre">spring-mvc.xml</span></code></p>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;mvc:annotation-driven&gt;</span>
    <span class="nt">&lt;mvc:argument-resolvers&gt;</span>
        <span class="c">&lt;!-- (1) --&gt;</span>
        <span class="nt">&lt;bean</span>
            <span class="na">class=</span><span class="s">&quot;org.springframework.data.web.PageableHandlerMethodArgumentResolver&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/mvc:argument-resolvers&gt;</span>
<span class="nt">&lt;/mvc:annotation-driven&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">&lt;mvc:argument-resolvers&gt;</span></code> に <code class="docutils literal"><span class="pre">org.springframework.data.web.PageableHandlerMethodArgumentResolver</span></code> を指定する。</div>
<div class="line"><code class="docutils literal"><span class="pre">PageableHandlerMethodArgumentResolver</span></code> で指定できるプロパティについては、「 <a class="reference internal" href="#paginatin-appendix-pageablehandlermethodargumentresolver"><span class="std std-ref">PageableHandlerMethodArgumentResolver のプロパティ値について</span></a> 」を参照されたい。</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="id13">
<h3><a class="toc-backref" href="#id33">4.5.2.2. ページ検索の実装</a><a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h3>
<p>ページ検索を実現するための実装方法を以下に示す。</p>
<div class="section" id="pagination-how-to-use-page-search-impl-app">
<span id="id14"></span><h4><a class="toc-backref" href="#id34">4.5.2.2.1. アプリケーション層の実装</a><a class="headerlink" href="#pagination-how-to-use-page-search-impl-app" title="Permalink to this headline">¶</a></h4>
<p>ページ検索に必要な情報(検索対象のページ位置、取得件数、ソート条件)を、Controllerの引数として受け取り、Serviceのメソッドに引き渡す。</p>
<ul class="simple">
<li>Controller</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&quot;list&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">list</span><span class="o">(</span><span class="nd">@Validated</span> <span class="n">ArticleSearchCriteriaForm</span> <span class="n">form</span><span class="o">,</span>
        <span class="n">BindingResult</span> <span class="n">result</span><span class="o">,</span>
        <span class="n">Pageable</span> <span class="n">pageable</span><span class="o">,</span> <span class="c1">// (1)</span>
        <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>

    <span class="n">ArticleSearchCriteria</span> <span class="n">criteria</span> <span class="o">=</span> <span class="n">beanMapper</span><span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">form</span><span class="o">,</span>
            <span class="n">ArticleSearchCriteria</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="n">Page</span><span class="o">&lt;</span><span class="n">Article</span><span class="o">&gt;</span> <span class="n">page</span> <span class="o">=</span> <span class="n">articleService</span><span class="o">.</span><span class="na">searchArticle</span><span class="o">(</span><span class="n">criteria</span><span class="o">,</span> <span class="n">pageable</span><span class="o">);</span> <span class="c1">// (2)</span>

    <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&quot;page&quot;</span><span class="o">,</span> <span class="n">page</span><span class="o">);</span> <span class="c1">// (3)</span>

    <span class="k">return</span> <span class="s">&quot;article/list&quot;</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">ハンドラメソッドの引数として <code class="docutils literal"><span class="pre">Pageable</span></code> を指定する。</div>
<div class="line"><code class="docutils literal"><span class="pre">Pageable</span></code> オブジェクトには、ページ検索に必要な情報(検索対象のページ位置、取得件数、ソート条件)が格納されている。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Serviceのメソッドの引数に <code class="docutils literal"><span class="pre">Pageable</span></code> オブジェクトを指定して呼び出す。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">Serviceから返却された検索結果( <code class="docutils literal"><span class="pre">Page</span></code> オブジェクト )を <code class="docutils literal"><span class="pre">Model</span></code> に追加する。 <code class="docutils literal"><span class="pre">Model</span></code> に追加することで、View(テンプレートHTML)から参照できるようになる。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>リクエストパラメータにページ検索に必要な情報の指定がない場合の動作について</strong></p>
<p>ページ検索に必要な情報(検索対象のページ位置、取得件数、ソート条件)がリクエストパラメータに指定されていない場合は、デフォルト値が適用される。
デフォルト値は、以下の通り。</p>
<ul class="simple">
<li>検索対象のページ位置 : <cite>0</cite> (1ページ目)</li>
<li>取得件数 : <cite>20</cite></li>
<li>ソート条件 : <cite>null</cite> (ソート条件なし)</li>
</ul>
<p>デフォルト値は、以下の２つの方法で変更することができる。</p>
<ul class="last simple">
<li>ハンドラメソッドの <code class="docutils literal"><span class="pre">Pageable</span></code> の引数に、 <code class="docutils literal"><span class="pre">&#64;org.springframework.data.web.PageableDefault</span></code> アノテーションを指定してデフォルト値を定義する。</li>
<li><code class="docutils literal"><span class="pre">PageableHandlerMethodArgumentResolver</span></code> の <code class="docutils literal"><span class="pre">fallbackPageable</span></code> プロパティにデフォルト値を定義した <code class="docutils literal"><span class="pre">Pageable</span></code> オブジェクトを指定する。</li>
</ul>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&#64;PageableDefault</span></code> アノテーションを使用してデフォルト値を指定する方法について説明する。</div>
<div class="line">ページ検索処理毎にデフォルト値を変更する必要がある場合は、<code class="docutils literal"><span class="pre">&#64;PageableDefault</span></code> アノテーションを使ってデフォルト値を指定する。</div>
</div>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&quot;list&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">list</span><span class="o">(</span><span class="nd">@Validated</span> <span class="n">ArticleSearchCriteriaForm</span> <span class="n">form</span><span class="o">,</span>
        <span class="n">BindingResult</span> <span class="n">result</span><span class="o">,</span>
        <span class="nd">@PageableDefault</span><span class="o">(</span> <span class="c1">// (1)</span>
                <span class="n">page</span> <span class="o">=</span> <span class="mi">0</span><span class="o">,</span>    <span class="c1">// (2)</span>
                <span class="n">size</span> <span class="o">=</span> <span class="mi">50</span><span class="o">,</span>   <span class="c1">// (3)</span>
                <span class="n">direction</span> <span class="o">=</span> <span class="n">Direction</span><span class="o">.</span><span class="na">DESC</span><span class="o">,</span>  <span class="c1">// (4)</span>
                <span class="n">sort</span> <span class="o">=</span> <span class="o">{</span>     <span class="c1">// (5)</span>
                    <span class="s">&quot;publishedDate&quot;</span><span class="o">,</span>
                    <span class="s">&quot;articleId&quot;</span>
                    <span class="o">}</span>
                <span class="o">)</span> <span class="n">Pageable</span> <span class="n">pageable</span><span class="o">,</span>
        <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// ...</span>
    <span class="k">return</span> <span class="s">&quot;article/list&quot;</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="70%" />
<col width="20%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
<th class="head">デフォルト値</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">Pageable</span></code> の引数に <code class="docutils literal"><span class="pre">&#64;PageableDefault</span></code> アノテーションを指定する。</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">-</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">ページ位置のデフォルト値を変更する場合は、 <code class="docutils literal"><span class="pre">&#64;PageableDefault</span></code> のpage属性に値を指定する。</div>
<div class="line">通常変更する必要はない。</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">0</span></code></div>
<div class="line">(1ページ目)</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">取得件数のデフォルト値を変更する場合は、 <code class="docutils literal"><span class="pre">&#64;PageableDefault</span></code> のsize又はvalue属性に値を指定する。</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">10</span></code></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">ソート条件のデフォルト値を変更する場合は、 <code class="docutils literal"><span class="pre">&#64;PageableDefault</span></code> のdirection属性に値を指定する。</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">Direction.ASC</span></code></div>
<div class="line">(昇順)</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">ソート条件のソート項目を指定する場合は、 <code class="docutils literal"><span class="pre">&#64;PageableDefault</span></code> のsort属性にソート項目を指定する。</div>
<div class="line">複数の項目でソートする場合は、ソートするプロパティ名を配列で指定する。</div>
<div class="line">上記例では、<code class="docutils literal"><span class="pre">ORDER</span> <span class="pre">BY</span> <span class="pre">publishedDate</span> <span class="pre">DESC,</span> <span class="pre">articleId</span> <span class="pre">DESC</span></code> のようなOrder By句をQueryに追加することになる。</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">空の配列</div>
<div class="line">(ソート項目なし)</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>&#64;PageableDefaultアノテーションで指定できるソート順について</strong></p>
<p class="last"><code class="docutils literal"><span class="pre">&#64;PageableDefault</span></code> アノテーションで指定できるソート順は昇順か降順のどちらか一つなので、項目ごとに異なるソート順を指定したい場合は <code class="docutils literal"><span class="pre">&#64;org.springframework.data.web.SortDefaults</span></code> アノテーションを使用する必要がある。
具体的には、 <code class="docutils literal"><span class="pre">ORDER</span> <span class="pre">BY</span> <span class="pre">publishedDate</span> <span class="pre">DESC,</span> <span class="pre">articleId</span> <span class="pre">ASC</span></code> というソート順にしたい場合である。</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p><strong>取得件数のデフォルト値のみ変更する場合の指定方法</strong></p>
<p class="last">取得件数のデフォルト値のみ変更する場合は、 <code class="docutils literal"><span class="pre">&#64;PageableDefault(50)</span></code> と指定することもできる。これは <code class="docutils literal"><span class="pre">&#64;PageableDefault(size</span> <span class="pre">=</span> <span class="pre">50)</span></code> と同じ動作となる。</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">&#64;SortDefaults</span></code> アノテーションを使用してデフォルト値を指定する方法について説明する。</div>
<div class="line"><code class="docutils literal"><span class="pre">&#64;SortDefaults</span></code> アノテーションは、ソート項目が複数あり、項目ごとに異なるソート順を指定したい場合に使用する。</div>
</div>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&quot;list&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">list</span><span class="o">(</span>
        <span class="nd">@Validated</span> <span class="n">ArticleSearchCriteriaForm</span> <span class="n">form</span><span class="o">,</span>
        <span class="n">BindingResult</span> <span class="n">result</span><span class="o">,</span>
        <span class="nd">@PageableDefault</span><span class="o">(</span><span class="n">size</span> <span class="o">=</span> <span class="mi">50</span><span class="o">)</span>
        <span class="nd">@SortDefaults</span><span class="o">(</span>  <span class="c1">// (1)</span>
                <span class="o">{</span>
                    <span class="nd">@SortDefault</span><span class="o">(</span>  <span class="c1">// (2)</span>
                                 <span class="n">sort</span> <span class="o">=</span> <span class="s">&quot;publishedDate&quot;</span><span class="o">,</span>    <span class="c1">// (3)</span>
                                 <span class="n">direction</span> <span class="o">=</span> <span class="n">Direction</span><span class="o">.</span><span class="na">DESC</span> <span class="c1">// (4)</span>
                                <span class="o">),</span>
                    <span class="nd">@SortDefault</span><span class="o">(</span>
                                 <span class="n">sort</span> <span class="o">=</span> <span class="s">&quot;articleId&quot;</span>
                                <span class="o">)</span>
                <span class="o">})</span> <span class="n">Pageable</span> <span class="n">pageable</span><span class="o">,</span>
        <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// ...</span>
    <span class="k">return</span> <span class="s">&quot;article/list&quot;</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="70%" />
<col width="20%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
<th class="head">デフォルト値</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">Pageable</span></code> の引数に <code class="docutils literal"><span class="pre">&#64;SortDefaults</span></code> アノテーションを指定する。</div>
<div class="line"><code class="docutils literal"><span class="pre">&#64;SortDefaults</span></code> アノテーションには、複数の <code class="docutils literal"><span class="pre">&#64;org.springframework.data.web.SortDefault</span></code> アノテーションを配列として指定することができる。</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">-</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">&#64;SortDefaults</span></code> アノテーションの value属性に、 <code class="docutils literal"><span class="pre">&#64;SortDefault</span></code> アノテーションを指定する。</div>
<div class="line">複数指定する場合は配列として指定する。</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">-</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">&#64;PageableDefault</span></code> のsort又はvalue属性にソート項目を指定する。</div>
<div class="line">複数の項目を指定する場合は配列として指定する。</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">空の配列</div>
<div class="line">(ソート項目なし)</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">ソート条件のデフォルト値を変更する場合は、<code class="docutils literal"><span class="pre">&#64;PageableDefault</span></code> のdirection属性に値を指定する。</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">Direction.ASC</span></code></div>
<div class="line">(昇順)</div>
</div>
</td>
</tr>
</tbody>
</table>
<p>上記例では、 <code class="docutils literal"><span class="pre">ORDER</span> <span class="pre">BY</span> <span class="pre">publishedDate</span> <span class="pre">DESC,</span> <span class="pre">articleId</span> <span class="pre">ASC</span></code> のようなOrder By句をQueryに追加することになる。</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p><strong>ソート項目のデフォルト値のみ指定する場合の指定方法</strong></p>
<p class="last">取得項目のみ指定する場合は、 <code class="docutils literal"><span class="pre">&#64;PageableDefault(&quot;articleId&quot;)</span></code> と指定することもできる。
これは <code class="docutils literal"><span class="pre">&#64;PageableDefault(sort</span> <span class="pre">=</span> <span class="pre">&quot;articleId&quot;)</span></code> や <code class="docutils literal"><span class="pre">&#64;PageableDefault(sort</span> <span class="pre">=</span> <span class="pre">&quot;articleId&quot;,</span> <span class="pre">direction</span> <span class="pre">=</span> <span class="pre">Direction.ASC)</span></code> と同じ動作となる。</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>アプリケーション全体のデフォルト値を変更する必要がある場合は、 <code class="file docutils literal"><span class="pre">spring-mvc.xml</span></code> に定義した <code class="docutils literal"><span class="pre">PageableHandlerMethodArgumentResolver</span></code>
の <code class="docutils literal"><span class="pre">fallbackPageable</span></code> プロパティにデフォルト値を定義した <code class="docutils literal"><span class="pre">Pageable</span></code> オブジェクトを指定する。</p>
<p><code class="docutils literal"><span class="pre">fallbackPageable</span></code> の説明や具体的な設定例については、「 <a class="reference internal" href="#paginatin-appendix-pageablehandlermethodargumentresolver"><span class="std std-ref">PageableHandlerMethodArgumentResolver のプロパティ値について</span></a> 」を参照されたい。</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="mybatis3">
<h4><a class="toc-backref" href="#id35">4.5.2.2.2. ドメイン層の実装(MyBatis3編)</a><a class="headerlink" href="#mybatis3" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">MyBatisを使用してデータベースにアクセスする場合は、Controllerから受け取った <code class="docutils literal"><span class="pre">Pageable</span></code> オブジェクトより、必要な情報を抜き出してRepositoryに引き渡す。</div>
<div class="line">該当データを抽出するためのSQLやソート条件については、SQLマッピングで実装する必要がある。</div>
</div>
<p>ドメイン層で実装するページ検索処理の詳細については、</p>
<ul class="simple">
<li><a class="reference internal" href="../DataAccessDetail/DataAccessMyBatis3.html#dataaccessmybatis3howtousefindpageusingmybatisfunction"><span class="std std-ref">Entityのページネーション検索(MyBatis3標準方式)</span></a></li>
<li><a class="reference internal" href="../DataAccessDetail/DataAccessMyBatis3.html#dataaccessmybatis3howtousefindpageusingsqlfilter"><span class="std std-ref">Entityのページネーション検索(SQL絞り込み方式)</span></a></li>
<li><a class="reference internal" href="../DataAccessDetail/DataAccessMyBatis3.html#dataaccessmybatis3howtousefindpageusingsort"><span class="std std-ref">Entityのページネーション検索(検索結果のソート)</span></a></li>
</ul>
<p>を参照されたい。</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="id15">
<h3><a class="toc-backref" href="#id36">4.5.2.3. テンプレートHTMLの実装</a><a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h3>
<p>ページ検索処理で取得した <code class="docutils literal"><span class="pre">Page</span></code> オブジェクトからデータを取得し、ページネーションを行う画面に取得したデータ、ページネーションリンク、ページネーションに関する情報(合計件数、合計ページ数、表示ページ数など)を表示する方法について説明する。</p>
<div class="line-block">
<div class="line">ページネーションリンクやページネーション情報の表示は、アプリケーション内で共通的に使用されるため部品化することを推奨する。</div>
<div class="line">また、ページネーションリンクの出力範囲や該当ページの表示データ範囲の計算等の複雑な計算ロジックはテンプレートHTMLではなくJavaで実装することを推奨する。</div>
</div>
<p>そのため、ここでは以下の構成でテンプレートHTMLの実装を行う例を示す。</p>
<blockquote>
<div><table border="1" class="colwidths-given docutils">
<colgroup>
<col width="40%" />
<col width="60%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">成果物の構成要素</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">テンプレートHTML（ページネーションを行う画面）</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">取得したデータの一覧の表示を実装する</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">テンプレートHTML（フラグメント）</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">すべてのテンプレートHTML（ページネーションを行う画面）で同様の、ページネーションリンクやページネーション情報の表示の実装を共通化する</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">式オブジェクト</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">ページネーションリンクの出力範囲や該当ページの表示データ範囲の計算ロジックを実装する</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line">なお、「<a class="reference internal" href="#pagination-how-to-use-page-search-impl-app"><span class="std std-ref">アプリケーション層の実装</span></a>」の例では、 <code class="docutils literal"><span class="pre">Page</span></code> オブジェクトを <code class="docutils literal"><span class="pre">page</span></code> という名前で <code class="docutils literal"><span class="pre">Model</span></code> に格納している。</div>
<div class="line">そのため、テンプレートHTMLの実装では <code class="docutils literal"><span class="pre">page</span></code> という名前を指定して <code class="docutils literal"><span class="pre">Page</span></code> オブジェクトにアクセスすることができる。</div>
</div>
<div class="section" id="id16">
<h4><a class="toc-backref" href="#id37">4.5.2.3.1. 取得データの表示</a><a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h4>
<p>ページ検索処理で取得したデータを表示するための実装例を以下に示す。
データの表示内容は画面ごとに異なるため、共通化せずテンプレートHTML（ページネーションを行う画面）に実装すると良い。</p>
<ul class="simple">
<li>テンプレートHTML（ページネーションを行う画面）</li>
</ul>
<blockquote>
<div><div class="highlight-html"><div class="highlight"><pre><span></span><span class="c">&lt;!--/* ... */--&gt;</span>

<span class="c">&lt;!--/* (1) */--&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:if</span><span class="o">=</span><span class="s">&quot;${page} != null&quot;</span> <span class="na">th:remove</span><span class="o">=</span><span class="s">&quot;tag&quot;</span><span class="p">&gt;</span>

  <span class="p">&lt;</span><span class="nt">table</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;maintable&quot;</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">thead</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>No<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Class<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Title<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Overview<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Published Date<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">thead</span><span class="p">&gt;</span>

    <span class="c">&lt;!--/* (2) */--&gt;</span>
    <span class="p">&lt;</span><span class="nt">tbody</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">tr</span> <span class="na">th:each</span><span class="o">=</span><span class="s">&quot;article, status : ${page.content}&quot;</span> <span class="na">th:object</span><span class="o">=</span><span class="s">&quot;${article}&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">td</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;no&quot;</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;*{articleId}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">td</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;articleClass&quot;</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;*{articleClass.name}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">td</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;title&quot;</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;*{title}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">td</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;overview&quot;</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;*{overview}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">td</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;date&quot;</span>
          <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;*{#dates.format(publishDate, &#39;yyyy/MM/dd HH:mm:ss&#39;)}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">tbody</span><span class="p">&gt;</span>

  <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>

<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="c">&lt;!--/* ... */--&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">上記例では、条件に一致するデータが存在するかチェックを行い、一致するデータがない場合はヘッダ行も含めて表示していない。</div>
<div class="line">一致するデータがない場合でもヘッダ行は表示させる必要がある場合は、この分岐は不要となる</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">th:each</span></code> 属性を使用して、取得したデータの一覧を表示する。</div>
<div class="line">取得したデータは、 <code class="docutils literal"><span class="pre">Page</span></code> オブジェクトの <code class="docutils literal"><span class="pre">content</span></code> プロパティにリスト形式で格納されている。</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<ul class="simple">
<li>上記テンプレートHTMLで出力される画面例</li>
</ul>
<blockquote>
<div><div class="figure align-center">
<a class="reference internal image-reference" href="../../_images/pagination-how_to_use_view_list_screen.png"><img alt="Screen image of content table" src="../../_images/pagination-how_to_use_view_list_screen.png" style="width: 100%;" /></a>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="pagination-how-to-use-make-jsp-basic-paginationlink">
<span id="id17"></span><h4><a class="toc-backref" href="#id38">4.5.2.3.2. ページネーションリンクの表示</a><a class="headerlink" href="#pagination-how-to-use-make-jsp-basic-paginationlink" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">ページ移動するためのリンク(ページネーションリンク)は、「<a class="reference internal" href="#pagination-overview-page-display-paginationlink-structure"><span class="std std-ref">ページネーションリンクの構成</span></a>」にて説明した以下の5つのパーツに分けて出力を行う。</div>
</div>
<ul class="simple">
<li>最初のページに移動するためのリンク</li>
<li>前のページに移動するためのリンク</li>
<li>指定したページに移動するためのリンク</li>
<li>次のページに移動するためのリンク</li>
<li>最後のページに移動するためのリンク</li>
</ul>
<div class="line-block">
<div class="line">「指定したページに移動するためのリンク」の出力では、表示するリンクの範囲(開始位置、終了位置)を計算し出力数を制御する必要があり、複雑な計算ロジックを実装することになるため、テンプレートHTMLではなくJavaで実装することを推奨する。</div>
<div class="line">ここでは、表示するリンクの範囲(開始位置、終了位置)の計算を式オブジェクトに実装する方法を実装例として採用する。</div>
<div class="line"><br /></div>
<div class="line">また、ページネーションリンクはアプリケーション内で共通的に使用されるため、ページネーションリンクを生成するテンプレートHTMLをフラグメントとして定義する例を実装例として採用する。</div>
<div class="line">そのため、以下の流れで「ページネーションリンクの表示」の実装例を説明する。</div>
</div>
<ol class="arabic simple">
<li><a class="reference internal" href="#pagination-how-to-use-make-jsp-basic-paginationlink-link-expressionobject"><span class="std std-ref">リンクの出力範囲を計算する式オブジェクトを実装する</span></a></li>
<li><a class="reference internal" href="#pagination-how-to-use-make-jsp-basic-paginationlink-impl-fragment"><span class="std std-ref">テンプレートHTML（フラグメント）にページネーションリンクのHTMLを実装する</span></a></li>
<li><a class="reference internal" href="#pagination-how-to-use-make-jsp-basic-paginationlink-impl-usefragment"><span class="std std-ref">テンプレートHTML（ページネーションを行う画面）にフラグメントを利用してページネーションリンクを表示する</span></a></li>
</ol>
<div class="line-block">
<div class="line"><br /></div>
</div>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>指定したページに移動するためのリンクの出力範囲の計算の実装方法について</strong></p>
<p>この章で説明している式オブジェクトを使用した実装方法はあくまでも一例であり、実装方法を規定するものではない。他に以下のような実装方法があるため、プロジェクトの開発方針に則り実装していただきたい。</p>
<ul class="last simple">
<li><code class="docutils literal"><span class="pre">Page</span></code> オブジェクトを拡張し、表示するリンクの範囲(開始位置、終了位置)を計算、保持する。</li>
<li>ControllerのHelperクラスでリンクの範囲(開始位置、終了位置)を計算する。</li>
</ul>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="pagination-how-to-use-make-jsp-basic-paginationlink-link-expressionobject">
<span id="id18"></span><h5>4.5.2.3.2.1. リンクの出力範囲を計算する式オブジェクトを実装する<a class="headerlink" href="#pagination-how-to-use-make-jsp-basic-paginationlink-link-expressionobject" title="Permalink to this headline">¶</a></h5>
<div class="line-block">
<div class="line">「指定したページに移動するためのリンク」の出力では、表示するリンクの範囲(開始位置、終了位置)を計算し出力数を制御する必要があり、複雑な計算ロジックを実装することになるため、テンプレートHTMLではなくJavaで実装することを推奨する。</div>
<div class="line">ここでは、表示するリンクの範囲(開始位置、終了位置)を計算するメソッドを持つ式オブジェクトを実装し、カスタムダイアレクトを追加する方法について説明する。</div>
<div class="line">カスタムダイアレクトの追加の詳細については、「<a class="reference internal" href="Thymeleaf.html#thymeleaf-how-to-extend-add-custom-dialect"><span class="std std-ref">カスタムダイアレクトの追加</span></a> 」を参照されたい。</div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line">追加するカスタムダイアレクトの使用例は以下の通りである。</div>
</div>
<p><strong>テンプレート記述例</strong></p>
<div class="line-block">
<div class="line">ここでは、Pageオブジェクトとリンクの最大表示数を入力として、ページ番号のリストを出力する <code class="docutils literal"><span class="pre">#pageInfo.sequence(</span> <span class="pre">Pageオブジェクト,</span> <span class="pre">リンクの最大表示数)</span></code> メソッドを追加する。これを <code class="docutils literal"><span class="pre">th:each</span></code> 属性の引数として利用することで、指定したページに移動するためのリンクを繰り返し出力する。</div>
<div class="line">なお、以下に示す実装例では操作可否の制御( <code class="docutils literal"><span class="pre">disabled</span></code> 及び <code class="docutils literal"><span class="pre">active</span></code> )は行っていない。</div>
</div>
<div class="highlight-html"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">li</span> <span class="na">th:each</span><span class="o">=</span><span class="s">&quot;i : ${#pageInfo.sequence(page, 5)}&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">a</span> <span class="na">th:href</span><span class="o">=</span><span class="s">&quot;@{/sample(page=${i-1},size=${page.size})}&quot;</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${i}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
</pre></div>
</div>
<p><strong>独自属性の処理結果</strong></p>
<p>ページサイズが10、ページリンクの出力範囲が1から5までの場合、以下のように出力される。</p>
<div class="highlight-html"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/sample?page=0&amp;amp;size=10&quot;</span><span class="p">&gt;</span>1<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/sample?page=1&amp;amp;size=10&quot;</span><span class="p">&gt;</span>2<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/sample?page=2&amp;amp;size=10&quot;</span><span class="p">&gt;</span>3<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/sample?page=3&amp;amp;size=10&quot;</span><span class="p">&gt;</span>4<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/sample?page=4&amp;amp;size=10&quot;</span><span class="p">&gt;</span>5<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">まず、式オブジェクトを実装する。実装例を以下に示す。</div>
</div>
<p><strong>実装例</strong></p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">org.apache.poi.ss.formula.functions.T</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.domain.Page</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.thymeleaf.util.NumberUtils</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PageInfo</span> <span class="o">{</span>

    <span class="c1">// (1)</span>
    <span class="kd">public</span> <span class="n">Integer</span><span class="o">[]</span> <span class="nf">sequence</span><span class="o">(</span><span class="n">Page</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">page</span><span class="o">,</span> <span class="kt">int</span> <span class="n">pageLinkMaxDispNum</span><span class="o">)</span> <span class="o">{</span>

        <span class="c1">// (2)</span>
        <span class="kt">int</span> <span class="n">begin</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">max</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">page</span><span class="o">.</span><span class="na">getNumber</span><span class="o">()</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">pageLinkMaxDispNum</span> <span class="o">/</span> <span class="mi">2</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">end</span> <span class="o">=</span> <span class="n">begin</span> <span class="o">+</span> <span class="o">(</span><span class="n">pageLinkMaxDispNum</span> <span class="o">-</span> <span class="mi">1</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">end</span> <span class="o">&gt;</span> <span class="n">page</span><span class="o">.</span><span class="na">getTotalPages</span><span class="o">()</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">end</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="na">getTotalPages</span><span class="o">();</span>
            <span class="n">begin</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">max</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">end</span> <span class="o">-</span> <span class="o">(</span><span class="n">pageLinkMaxDispNum</span> <span class="o">-</span> <span class="mi">1</span><span class="o">));</span>
        <span class="o">}</span>

        <span class="c1">// (3)</span>
        <span class="k">return</span> <span class="n">NumberUtils</span><span class="o">.</span><span class="na">sequence</span><span class="o">(</span><span class="n">begin</span><span class="o">,</span> <span class="n">end</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">Page</span></code> オブジェクトとリンクの最大表示数を引数に取り、 <code class="docutils literal"><span class="pre">Integer[]</span></code> 型を返すメソッドを定義する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">表示するリンクの範囲(開始位置、終了位置)を計算する。</div>
<div class="line"><code class="docutils literal"><span class="pre">Page</span></code> オブジェクトの <code class="docutils literal"><span class="pre">number</span></code> プロパティは <code class="docutils literal"><span class="pre">0</span></code> 開始のため、 ページ番号を表示する際は <code class="docutils literal"><span class="pre">+1</span></code> が必要となる。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">計算したリンクの範囲(開始位置、終了位置)のリストを生成し返却する。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">次に、実装した式オブジェクトをテンプレートに適用するためにダイアレクトを実装する。実装例を以下に示す。</div>
</div>
<p><strong>実装例（式オブジェクトの登録）</strong></p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">PageInfoDialect</span> <span class="kd">implements</span> <span class="n">IExpressionObjectDialect</span> <span class="o">{</span>

    <span class="c1">// (1)</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">PAGE_INFO_DIALECT_NAME</span> <span class="o">=</span> <span class="s">&quot;pageInfo&quot;</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">EXPRESSION_OBJECT_NAMES</span> <span class="o">=</span> <span class="n">Collections</span>
            <span class="o">.</span><span class="na">singleton</span><span class="o">(</span><span class="n">PAGE_INFO_DIALECT_NAME</span><span class="o">);</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">IExpressionObjectFactory</span> <span class="nf">getExpressionObjectFactory</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">IExpressionObjectFactory</span><span class="o">()</span> <span class="o">{</span>

            <span class="c1">// (1)</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">getAllExpressionObjectNames</span><span class="o">()</span> <span class="o">{</span>
                <span class="k">return</span> <span class="n">EXPRESSION_OBJECT_NAMES</span><span class="o">;</span>
            <span class="o">}</span>

            <span class="c1">// (2)</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="n">Object</span> <span class="nf">buildObject</span><span class="o">(</span><span class="n">IExpressionContext</span> <span class="n">context</span><span class="o">,</span>
                    <span class="n">String</span> <span class="n">expressionObjectName</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">PAGE_INFO_DIALECT_NAME</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">expressionObjectName</span><span class="o">))</span> <span class="o">{</span>
                    <span class="k">return</span> <span class="k">new</span> <span class="n">PageInfo</span><span class="o">();</span>
                <span class="o">}</span>
                <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span>

            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isCacheable</span><span class="o">(</span><span class="n">String</span> <span class="n">expressionObjectName</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
            <span class="o">}</span>

        <span class="o">};</span>
    <span class="o">}</span>

    <span class="c1">// omitted</span>

<span class="o">}</span>
</pre></div>
</div>
<table border="1" class="colwidths-given longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">pageInfo</span></code> という名前で式オブジェクトを登録する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">実装した式オブジェクトを登録する。</div>
</div>
</td>
</tr>
</tbody>
</table>
<p>最後に、作成したカスタムダイアレクトの設定を行う。設定例を以下に示す。</p>
<p><strong>spring-mvc.xml</strong></p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;templateEngine&quot;</span> <span class="na">class=</span><span class="s">&quot;org.thymeleaf.spring5.SpringTemplateEngine&quot;</span><span class="nt">&gt;</span>

    <span class="c">&lt;!-- omitted --&gt;</span>

    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;additionalDialects&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;set&gt;</span>
            <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;org.thymeleaf.extras.springsecurity5.dialect.SpringSecurityDialect&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;org.thymeleaf.extras.java8time.dialect.Java8TimeDialect&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;com.example.sample.dialect.PageInfoDialect&quot;</span><span class="nt">/&gt;</span> <span class="c">&lt;!-- (1) --&gt;</span>
        <span class="nt">&lt;/set&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">テンプレートエンジンに作成したカスタムダイアレクトを追加する。</div>
</div>
</td>
</tr>
</tbody>
</table>
<p>以上でカスタムダイアレクトの実装及び設定は完了となる。</p>
</div>
<div class="section" id="html-html">
<span id="pagination-how-to-use-make-jsp-basic-paginationlink-impl-fragment"></span><h5>4.5.2.3.2.2. テンプレートHTML（フラグメント）にページネーションリンクのHTMLを実装する<a class="headerlink" href="#html-html" title="Permalink to this headline">¶</a></h5>
<p>ページネーションリンクのテンプレートHTMLのフラグメントの実装例を以下に示す。</p>
<div class="line-block">
<div class="line">以降で説明する実装例は、 <code class="docutils literal"><span class="pre">th:fragment</span></code> 属性を利用してページネーションリンクのHTMLを部品化している。</div>
<div class="line">ページネーションリンクは、アプリケーション内で共通的に使用されるため部品化することを推奨する。HTMLの部品化については、「<a class="reference internal" href="TemplateLayout.html#templatelayout-overview-fragment"><span class="std std-ref">Thymeleafのテンプレートレイアウト機能を使用したHTMLの部品化</span></a> 」を参照されたい。</div>
</div>
<p>以降、以下のファイル構成を前提に実装例を示す。</p>
<ul class="simple">
<li>File Path</li>
</ul>
<blockquote>
<div><div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">WEB-INF</span>
<span class="go">  └─views</span>
<span class="go">     └─pgnt</span>
<span class="go">           fragment.html     (フラグメントを定義するテンプレートHTML)</span>
<span class="go">           serchResult.html  (ページネーションを行う画面を実装するテンプレートHTML)</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li>テンプレートHTML(フラグメント)</li>
</ul>
<blockquote>
<div><div class="highlight-html"><div class="highlight"><pre><span></span><span class="c">&lt;!--/* ... */--&gt;</span>

<span class="c">&lt;!--/* (1), (2) */--&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:fragment</span><span class="o">=</span><span class="s">&quot;pagination (page)&quot;</span> <span class="na">th:object</span><span class="o">=</span><span class="s">&quot;${page}&quot;</span> <span class="na">th:remove</span><span class="o">=</span><span class="s">&quot;tag&quot;</span><span class="p">&gt;</span>

  <span class="c">&lt;!--/* (3), (4) */--&gt;</span>
  <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">th:if</span><span class="o">=</span><span class="s">&quot;*{totalElements} != 0&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;pagination&quot;</span>
    <span class="na">th:with</span><span class="o">=</span><span class="s">&quot;pageLinkMaxDispNum = 10, disabledHref = &#39;javascript:void(0)&#39;, currentUrl = ${#request.requestURI}&quot;</span><span class="p">&gt;</span>

    <span class="c">&lt;!--/* (5) */--&gt;</span>
    <span class="p">&lt;</span><span class="nt">li</span> <span class="na">th:class</span><span class="o">=</span><span class="s">&quot;*{isFirst()} ? &#39;disabled&#39;&quot;</span><span class="p">&gt;</span>
      <span class="c">&lt;!--/* (6) */--&gt;</span>
      <span class="p">&lt;</span><span class="nt">a</span> <span class="na">th:href</span><span class="o">=</span><span class="s">&quot;*{isFirst()} ? ${disabledHref} : @{{currentUrl}(currentUrl=${currentUrl},page=0,size=*{size})}&quot;</span><span class="p">&gt;</span><span class="ni">&amp;lt;&amp;lt;</span><span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>

    <span class="c">&lt;!--/* (7) */--&gt;</span>
    <span class="p">&lt;</span><span class="nt">li</span> <span class="na">th:class</span><span class="o">=</span><span class="s">&quot;*{isFirst()} ? &#39;disabled&#39;&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">a</span> <span class="na">th:href</span><span class="o">=</span><span class="s">&quot;*{isFirst()} ? ${disabledHref} : @{{currentUrl}(currentUrl=${currentUrl},page=*{number - 1},size=*{size})}&quot;</span><span class="p">&gt;</span><span class="ni">&amp;lt;</span><span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>

    <span class="c">&lt;!--/* (8) */--&gt;</span>
    <span class="p">&lt;</span><span class="nt">li</span> <span class="na">th:each</span><span class="o">=</span><span class="s">&quot;i : ${#pageInfo.sequence(page, pageLinkMaxDispNum)}&quot;</span>
      <span class="na">th:with</span><span class="o">=</span><span class="s">&quot;isActive=${i} == *{number + 1}&quot;</span> <span class="na">th:class</span><span class="o">=</span><span class="s">&quot;${isActive} ? &#39;active&#39;&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">a</span> <span class="na">th:href</span><span class="o">=</span><span class="s">&quot;${isActive} ? ${disabledHref} : @{{currentUrl}(currentUrl=${currentUrl},page=${i - 1},size=*{size})}&quot;</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${i}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>

    <span class="c">&lt;!--/* (9) */--&gt;</span>
    <span class="p">&lt;</span><span class="nt">li</span> <span class="na">th:class</span><span class="o">=</span><span class="s">&quot;*{isLast()} ? &#39;disabled&#39;&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">a</span> <span class="na">th:href</span><span class="o">=</span><span class="s">&quot;*{isLast()} ? ${disabledHref} : @{{currentUrl}(currentUrl=${currentUrl},page=*{number + 1},size=*{size})}&quot;</span><span class="p">&gt;</span><span class="ni">&amp;gt;</span><span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>

    <span class="c">&lt;!--/* (10) */--&gt;</span>
    <span class="p">&lt;</span><span class="nt">li</span> <span class="na">th:class</span><span class="o">=</span><span class="s">&quot;*{isLast()} ? &#39;disabled&#39;&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">a</span> <span class="na">th:href</span><span class="o">=</span><span class="s">&quot;*{isLast()} ? ${disabledHref} : @{{currentUrl}(currentUrl=${currentUrl},page=*{totalPages - 1},size=*{size})}&quot;</span><span class="p">&gt;</span><span class="ni">&amp;gt;&amp;gt;</span><span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>

  <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>

<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="c">&lt;!--/* ... */--&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">th:fragment</span></code> 属性を使用し、 <code class="docutils literal"><span class="pre">pagination</span></code> という名前でフラグメント化する。</div>
<div class="line"><code class="docutils literal"><span class="pre">Page</span></code> オブジェクトをパラメータとして受け取るための引数 <code class="docutils literal"><span class="pre">page</span></code> を定義する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">th:object</span></code> 属性にフラグメントの引数で受け取った <code class="docutils literal"><span class="pre">Page</span></code> オブジェクトを指定し、以降の処理でオブジェクト名を省略してプロパティを指定可能にする。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">&lt;ul&gt;</span></code> 要素を出力する。</div>
<div class="line"><code class="docutils literal"><span class="pre">th:if</span></code> 属性を用いてページの要素数が0ではない場合のみ <code class="docutils literal"><span class="pre">&lt;ul&gt;</span></code> 要素を出力するように制御している。</div>
<div class="line">ページネーションリンクであることを示すクラス名 <code class="docutils literal"><span class="pre">pagination</span></code> を指定している。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first line-block">
<div class="line"><code class="docutils literal"><span class="pre">th:with</span></code> 属性にてページネーションリンクを表示する際に使用するローカル変数を定義している。</div>
<div class="line"><code class="docutils literal"><span class="pre">pageLinkMaxDispNum</span></code> には、「指定したページに移動するためのリンク」の最大表示数を指定する。</div>
<div class="line"><code class="docutils literal"><span class="pre">disabledHref</span></code> には、ページリンク押下時の動作を無効化する場合( <code class="docutils literal"><span class="pre">active</span></code> 状態、または <code class="docutils literal"><span class="pre">disabled</span></code> 状態)に <code class="docutils literal"><span class="pre">th:href</span></code> 属性に指定する値を指定する。</div>
<div class="line"><code class="docutils literal"><span class="pre">currentUrl</span></code> には、各ページリンクの <code class="docutils literal"><span class="pre">th:href</span></code> 属性の設定に使用するURLのパスを設定する。</div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>disabledHrefの設定値について</strong></p>
<p>実装例では、 <code class="docutils literal"><span class="pre">disabledHref</span></code> には <code class="docutils literal"><span class="pre">javascript:void(0)</span></code> を設定している。
ページリンク押下時の動作を無効化するだけであれば、実装例と同じ設定でよい。</p>
<p class="last">ただし、実装例の設定でページリンクにフォーカスを移動又はマウスオーバーした場合、
ブラウザのステータスバーに <code class="docutils literal"><span class="pre">javascript:void(0)</span></code> が表示されることがある。
この挙動を変えたい場合は、JavaScriptを使用してページリンク押下時の動作を無効化する必要がある。</p>
</div>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<p><strong>currentUrlの設定値について</strong></p>
<p>実装例では <code class="docutils literal"><span class="pre">th:href</span></code> 属性に前回リクエストのURLを指定するため、 <code class="docutils literal"><span class="pre">currentUrl</span></code> に <code class="docutils literal"><span class="pre">HttpServletRequest</span></code> オブジェクトから取得したリクエストURIを設定している。
<code class="docutils literal"><span class="pre">th:href</span></code> 属性に前回リクエストのURLを指定するのであれば、実装例と同じ設定でよい。</p>
<p class="last"><code class="docutils literal"><span class="pre">th:href</span></code> 属性に前回リクエストのURL以外を設定する場合は、アプリケーションの要件に応じて <code class="docutils literal"><span class="pre">th:href</span></code> 属性の指定方法を変更すること。 <code class="docutils literal"><span class="pre">th:href</span></code> 属性に設定する値はフラグメントのパラメータとして受け取ることで対応可能である。</p>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">最初のページに移動するためのリンクを出力する。</div>
<div class="line">リンク先が現在のページである場合は <code class="docutils literal"><span class="pre">disabled</span></code> 状態としている。</div>
<div class="line">リンクが不要な場合は <code class="docutils literal"><span class="pre">&lt;li&gt;</span></code> 要素ごと削除すること。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">ページ移動するためのリクエストを送信する <cite>&lt;a&gt;</cite> 要素を出力する。</div>
<div class="line"><code class="docutils literal"><span class="pre">th:href</span></code> 属性は、現在のページが最初のページである場合は、ページリンク押下時の動作を無効化するため <code class="docutils literal"><span class="pre">disabledHref</span></code> を指定する。そうでない場合には、リンクURL式 <code class="docutils literal"><span class="pre">&#64;{}</span></code> を使用してリクエストURLを生成して指定する。リンクURL式 <code class="docutils literal"><span class="pre">&#64;{}</span></code> に指定するパスには(4)で定義した <code class="docutils literal"><span class="pre">currentUrl</span></code> を、パラメータにはページ位置と取得件数を指定する。</div>
<div class="line"><code class="docutils literal"><span class="pre">th:href</span></code> 属性に指定するリクエストURLの生成の詳細については、「<a class="reference internal" href="../../ImplementationAtEachLayer/ApplicationLayer.html#view-thymeleaf-requesturl-label"><span class="std std-ref">リクエストURLを生成する</span></a> 」を参照されたい。</div>
<div class="line">リンクとして表示する文字列は直接記載するか <code class="docutils literal"><span class="pre">th:text</span></code> 属性を用いて出力する。</div>
<div class="line"><br /></div>
<div class="line"><cite>&lt;a&gt;</cite> 要素の基本的な構造は、以降の <cite>&lt;a&gt;</cite> 要素も同様であるため説明は省略する。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">前のページに移動するためのリンクを出力する。</div>
<div class="line">リンク先が現在のページである場合は <code class="docutils literal"><span class="pre">disabled</span></code> 状態としている。</div>
<div class="line"><cite>&lt;a&gt;</cite> 要素の属性は、現在のページが最初のページであるかを判定し、 <code class="docutils literal"><span class="pre">th:href</span></code> 属性に値を設定している。</div>
<div class="line">リンクが不要な場合は <code class="docutils literal"><span class="pre">&lt;li&gt;</span></code> 要素ごと削除すること。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(8)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">指定したページに移動するためのリンクを <code class="docutils literal"><span class="pre">th:each</span></code> 属性を利用し、繰り返し処理を行うことで出力する。</div>
<div class="line"><code class="docutils literal"><span class="pre">th:each</span></code> 属性に指定する配列は、「<a class="reference internal" href="#pagination-how-to-use-make-jsp-basic-paginationlink-link-expressionobject"><span class="std std-ref">指定したページに移動するためのリンクの出力範囲の計算</span></a>」で作成したカスタムダイアレクトを使用して取得する。</div>
<div class="line">リンクが不要な場合は <code class="docutils literal"><span class="pre">&lt;li&gt;</span></code> 要素ごと削除すること。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(9)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">次のページに移動するためのリンクを出力する。</div>
<div class="line">リンク先が現在のページである場合は <code class="docutils literal"><span class="pre">disabled</span></code> 状態としている。</div>
<div class="line">リンクが不要な場合は <code class="docutils literal"><span class="pre">&lt;li&gt;</span></code> 要素ごと削除すること。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(10)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">最後のページに移動するためのリンクを出力する。</div>
<div class="line">リンク先が現在のページである場合は <code class="docutils literal"><span class="pre">disabled</span></code> 状態としている。</div>
<div class="line">リンクが不要な場合は <code class="docutils literal"><span class="pre">&lt;li&gt;</span></code> 要素ごと削除すること。</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="pagination-how-to-use-make-jsp-basic-paginationlink-impl-usefragment">
<span id="id19"></span><h5>4.5.2.3.2.3. テンプレートHTML（ページネーションを行う画面）にフラグメントを利用してページネーションリンクを表示する<a class="headerlink" href="#pagination-how-to-use-make-jsp-basic-paginationlink-impl-usefragment" title="Permalink to this headline">¶</a></h5>
<p>「<a class="reference internal" href="#pagination-how-to-use-make-jsp-basic-paginationlink-impl-fragment"><span class="std std-ref">テンプレートHTML（フラグメント）にページネーションリンクのHTMLを実装する</span></a> 」で実装したフラグメントを利用してページネーションリンクを表示するテンプレートHTML実装例を以下に示す。</p>
<ul class="simple">
<li>テンプレートHTML(ページネーションを行う画面)</li>
</ul>
<blockquote>
<div><div class="highlight-html"><div class="highlight"><pre><span></span><span class="c">&lt;!--/* ... */--&gt;</span>

<span class="c">&lt;!--/* (1) */--&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&quot;~{pgnt/fragment :: pagination (${page})}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="c">&lt;!--/* ... */--&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">th:replace</span></code> 属性を使用して、テンプレートである <code class="docutils literal"><span class="pre">pgnt/fragment.html</span></code> の <code class="docutils literal"><span class="pre">pagination</span></code> フラグメントの内容で <code class="docutils literal"><span class="pre">div</span></code> タグ以下の内容を置換している。</div>
<div class="line">パラメータとして <code class="docutils literal"><span class="pre">Page</span></code> オブジェクトを指定している。</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<ul class="simple">
<li>出力されるHTML</li>
</ul>
<blockquote>
<div><p>下記の出力例は、<code class="docutils literal"><span class="pre">?page=0&amp;size=10</span></code> を指定して検索した際の結果である。</p>
<div class="highlight-html"><div class="highlight"><pre><span></span> <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
     <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;disabled&quot;</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;javascript:void(0)&quot;</span><span class="p">&gt;</span><span class="ni">&amp;lt;&amp;lt;</span><span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
     <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;disabled&quot;</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;javascript:void(0)&quot;</span><span class="p">&gt;</span><span class="ni">&amp;lt;</span><span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
     <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;active&quot;</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;javascript:void(0)&quot;</span><span class="p">&gt;</span>1<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
     <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;?page=1&amp;size=10&quot;</span><span class="p">&gt;</span>2<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
     <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;?page=2&amp;size=10&quot;</span><span class="p">&gt;</span>3<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
     <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;?page=3&amp;size=10&quot;</span><span class="p">&gt;</span>4<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
     <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;?page=4&amp;size=10&quot;</span><span class="p">&gt;</span>5<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
     <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;?page=5&amp;size=10&quot;</span><span class="p">&gt;</span>6<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
     <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;?page=6&amp;size=10&quot;</span><span class="p">&gt;</span>7<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
     <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;?page=7&amp;size=10&quot;</span><span class="p">&gt;</span>8<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
     <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;?page=8&amp;size=10&quot;</span><span class="p">&gt;</span>9<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
     <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;?page=9&amp;size=10&quot;</span><span class="p">&gt;</span>10<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
     <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;?page=1&amp;size=10&quot;</span><span class="p">&gt;</span><span class="ni">&amp;gt;</span><span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
     <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;?page=9&amp;size=10&quot;</span><span class="p">&gt;</span><span class="ni">&amp;gt;&amp;gt;</span><span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
</pre></div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line">ページネーションリンク用のスタイルシートを用意しないと以下のような表示となる。</div>
<div class="line">見てわかる通り、ページネーションリンクとして成立していない。</div>
</div>
<blockquote>
<div><div class="figure">
<a class="reference internal image-reference" href="../../_images/pagination-how_to_use_jsp_not_applied_css.png"><img alt="Screen image that style sheet is not applied." src="../../_images/pagination-how_to_use_jsp_not_applied_css.png" style="width: 120px; height: 290px;" /></a>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line">ページネーションリンクとして成立する最低限のスタイルシートの定義の追加を行うと、以下のような表示となる。</div>
</div>
<ul class="simple">
<li>画面イメージ</li>
</ul>
<blockquote>
<div><div class="figure">
<a class="reference internal image-reference" href="../../_images/pagination-how_to_use_jsp_applied_simple_css.png"><img alt="Screen image that simple style sheet applied." src="../../_images/pagination-how_to_use_jsp_applied_simple_css.png" style="width: 290px; height: 40px;" /></a>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>ページネーションリンクとして成立したが、以下2つの問題が残る。</p>
<ul class="simple">
<li>押下できるリンクと押下できないリンクの区別ができない。</li>
<li>現在表示しているページ位置がわからない。</li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>上記の問題を解決する手段として、Bootstrap v3.0.0のスタイルシートと適用すると、以下のような表示となる。</p>
<ul class="simple">
<li>画面イメージ</li>
</ul>
<blockquote>
<div><div class="figure">
<a class="reference internal image-reference" href="../../_images/pagination-how_to_use_jsp_applied_bootstrap_v3_0_0_css.png"><img alt="Screen image that v3.0.0 of bootstrap is applied." src="../../_images/pagination-how_to_use_jsp_applied_bootstrap_v3_0_0_css.png" style="width: 520px; height: 70px;" /></a>
</div>
</div></blockquote>
<ul class="simple">
<li>スタイルシート</li>
</ul>
<blockquote>
<div><div class="line-block">
<div class="line">bootstrap v3.0.0 の cssファイルを <code class="docutils literal"><span class="pre">$WEB_APP_ROOT/resources/vendor/bootstrap-3.0.0/css/bootstrap.css</span></code> に配置する。</div>
<div class="line">以下、ページネーション関連のスタイル定義の抜粋。</div>
</div>
<div class="highlight-css"><div class="highlight"><pre><span></span><span class="p">.</span><span class="nc">pagination</span> <span class="p">{</span>
  <span class="k">display</span><span class="p">:</span> <span class="kc">inline-block</span><span class="p">;</span>
  <span class="k">padding-left</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">margin</span><span class="p">:</span> <span class="mi">20</span><span class="kt">px</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">border-radius</span><span class="p">:</span> <span class="mi">4</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">pagination</span> <span class="o">&gt;</span> <span class="nt">li</span> <span class="p">{</span>
  <span class="k">display</span><span class="p">:</span> <span class="kc">inline</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">pagination</span> <span class="o">&gt;</span> <span class="nt">li</span> <span class="o">&gt;</span> <span class="nt">a</span><span class="o">,</span>
<span class="p">.</span><span class="nc">pagination</span> <span class="o">&gt;</span> <span class="nt">li</span> <span class="o">&gt;</span> <span class="nt">span</span> <span class="p">{</span>
  <span class="k">position</span><span class="p">:</span> <span class="kc">relative</span><span class="p">;</span>
  <span class="k">float</span><span class="p">:</span> <span class="kc">left</span><span class="p">;</span>
  <span class="k">padding</span><span class="p">:</span> <span class="mi">6</span><span class="kt">px</span> <span class="mi">12</span><span class="kt">px</span><span class="p">;</span>
  <span class="k">margin-left</span><span class="p">:</span> <span class="mi">-1</span><span class="kt">px</span><span class="p">;</span>
  <span class="k">line-height</span><span class="p">:</span> <span class="mf">1.428571429</span><span class="p">;</span>
  <span class="k">text-decoration</span><span class="p">:</span> <span class="kc">none</span><span class="p">;</span>
  <span class="k">background-color</span><span class="p">:</span> <span class="mh">#ffffff</span><span class="p">;</span>
  <span class="k">border</span><span class="p">:</span> <span class="mi">1</span><span class="kt">px</span> <span class="kc">solid</span> <span class="mh">#dddddd</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">pagination</span> <span class="o">&gt;</span> <span class="nt">li</span><span class="p">:</span><span class="nd">first-child</span> <span class="o">&gt;</span> <span class="nt">a</span><span class="o">,</span>
<span class="p">.</span><span class="nc">pagination</span> <span class="o">&gt;</span> <span class="nt">li</span><span class="p">:</span><span class="nd">first-child</span> <span class="o">&gt;</span> <span class="nt">span</span> <span class="p">{</span>
  <span class="k">margin-left</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">border-bottom-left-radius</span><span class="p">:</span> <span class="mi">4</span><span class="kt">px</span><span class="p">;</span>
  <span class="k">border-top-left-radius</span><span class="p">:</span> <span class="mi">4</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">pagination</span> <span class="o">&gt;</span> <span class="nt">li</span><span class="p">:</span><span class="nd">last-child</span> <span class="o">&gt;</span> <span class="nt">a</span><span class="o">,</span>
<span class="p">.</span><span class="nc">pagination</span> <span class="o">&gt;</span> <span class="nt">li</span><span class="p">:</span><span class="nd">last-child</span> <span class="o">&gt;</span> <span class="nt">span</span> <span class="p">{</span>
  <span class="k">border-top-right-radius</span><span class="p">:</span> <span class="mi">4</span><span class="kt">px</span><span class="p">;</span>
  <span class="k">border-bottom-right-radius</span><span class="p">:</span> <span class="mi">4</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">pagination</span> <span class="o">&gt;</span> <span class="nt">li</span> <span class="o">&gt;</span> <span class="nt">a</span><span class="p">:</span><span class="nd">hover</span><span class="o">,</span>
<span class="p">.</span><span class="nc">pagination</span> <span class="o">&gt;</span> <span class="nt">li</span> <span class="o">&gt;</span> <span class="nt">span</span><span class="p">:</span><span class="nd">hover</span><span class="o">,</span>
<span class="p">.</span><span class="nc">pagination</span> <span class="o">&gt;</span> <span class="nt">li</span> <span class="o">&gt;</span> <span class="nt">a</span><span class="p">:</span><span class="nd">focus</span><span class="o">,</span>
<span class="p">.</span><span class="nc">pagination</span> <span class="o">&gt;</span> <span class="nt">li</span> <span class="o">&gt;</span> <span class="nt">span</span><span class="p">:</span><span class="nd">focus</span> <span class="p">{</span>
  <span class="k">background-color</span><span class="p">:</span> <span class="mh">#eeeeee</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">pagination</span> <span class="o">&gt;</span> <span class="p">.</span><span class="nc">active</span> <span class="o">&gt;</span> <span class="nt">a</span><span class="o">,</span>
<span class="p">.</span><span class="nc">pagination</span> <span class="o">&gt;</span> <span class="p">.</span><span class="nc">active</span> <span class="o">&gt;</span> <span class="nt">span</span><span class="o">,</span>
<span class="p">.</span><span class="nc">pagination</span> <span class="o">&gt;</span> <span class="p">.</span><span class="nc">active</span> <span class="o">&gt;</span> <span class="nt">a</span><span class="p">:</span><span class="nd">hover</span><span class="o">,</span>
<span class="p">.</span><span class="nc">pagination</span> <span class="o">&gt;</span> <span class="p">.</span><span class="nc">active</span> <span class="o">&gt;</span> <span class="nt">span</span><span class="p">:</span><span class="nd">hover</span><span class="o">,</span>
<span class="p">.</span><span class="nc">pagination</span> <span class="o">&gt;</span> <span class="p">.</span><span class="nc">active</span> <span class="o">&gt;</span> <span class="nt">a</span><span class="p">:</span><span class="nd">focus</span><span class="o">,</span>
<span class="p">.</span><span class="nc">pagination</span> <span class="o">&gt;</span> <span class="p">.</span><span class="nc">active</span> <span class="o">&gt;</span> <span class="nt">span</span><span class="p">:</span><span class="nd">focus</span> <span class="p">{</span>
  <span class="k">z-index</span><span class="p">:</span> <span class="mi">2</span><span class="p">;</span>
  <span class="k">color</span><span class="p">:</span> <span class="mh">#ffffff</span><span class="p">;</span>
  <span class="k">cursor</span><span class="p">:</span> <span class="kc">default</span><span class="p">;</span>
  <span class="k">background-color</span><span class="p">:</span> <span class="mh">#428bca</span><span class="p">;</span>
  <span class="k">border-color</span><span class="p">:</span> <span class="mh">#428bca</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">pagination</span> <span class="o">&gt;</span> <span class="p">.</span><span class="nc">disabled</span> <span class="o">&gt;</span> <span class="nt">span</span><span class="o">,</span>
<span class="p">.</span><span class="nc">pagination</span> <span class="o">&gt;</span> <span class="p">.</span><span class="nc">disabled</span> <span class="o">&gt;</span> <span class="nt">a</span><span class="o">,</span>
<span class="p">.</span><span class="nc">pagination</span> <span class="o">&gt;</span> <span class="p">.</span><span class="nc">disabled</span> <span class="o">&gt;</span> <span class="nt">a</span><span class="p">:</span><span class="nd">hover</span><span class="o">,</span>
<span class="p">.</span><span class="nc">pagination</span> <span class="o">&gt;</span> <span class="p">.</span><span class="nc">disabled</span> <span class="o">&gt;</span> <span class="nt">a</span><span class="p">:</span><span class="nd">focus</span> <span class="p">{</span>
  <span class="k">color</span><span class="p">:</span> <span class="mh">#999999</span><span class="p">;</span>
  <span class="k">cursor</span><span class="p">:</span> <span class="kc">not-allowed</span><span class="p">;</span>
  <span class="k">background-color</span><span class="p">:</span> <span class="mh">#ffffff</span><span class="p">;</span>
  <span class="k">border-color</span><span class="p">:</span> <span class="mh">#dddddd</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li>テンプレートHTML</li>
</ul>
<blockquote>
<div><p>テンプレートHTMLでは配置したcssファイルを読み込む定義を追加する。</p>
<div class="highlight-html"><div class="highlight"><pre><span></span><span class="c">&lt;!--/* ... */--&gt;</span>

<span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">th:href</span><span class="o">=</span><span class="s">&quot;@{/resources/vendor/bootstrap/dist/css/bootstrap.min.css}&quot;</span><span class="p">&gt;</span>

<span class="c">&lt;!--/* ... */--&gt;</span>
</pre></div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="id20">
<h4><a class="toc-backref" href="#id39">4.5.2.3.3. ページネーション情報の表示</a><a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h4>
<p>ページネーションに関連する情報(合計件数、合計ページ数、表示ページ数など)を表示するための実装例を以下に示す。</p>
<p>ここでは、どの画面でも共通のページネーション情報を表示するため、テンプレートHTML（フラグメント）に実装する。また、ページネーション情報に出力する「該当ページの表示データ範囲」については、計算ロジックを伴うため式オブジェクトに実装する。</p>
<ul class="simple">
<li>画面例</li>
</ul>
<blockquote>
<div><div class="figure">
<a class="reference internal image-reference" href="../../_images/pagination-how_to_use_view_pagination_info1.png"><img alt="Screen image of pagination information(total results, current pages, total pages)" src="../../_images/pagination-how_to_use_view_pagination_info1.png" style="width: 400px; height: 250px;" /></a>
</div>
</div></blockquote>
<ul class="simple">
<li>テンプレートHTML（フラグメント）</li>
</ul>
<blockquote>
<div><div class="highlight-html"><div class="highlight"><pre><span></span><span class="c">&lt;!--/* ... */--&gt;</span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:fragment</span><span class="o">=</span><span class="s">&quot;paginationInfo (page)&quot;</span> <span class="na">th:object</span><span class="o">=</span><span class="s">&quot;${page}&quot;</span> <span class="na">th:remove</span><span class="o">=</span><span class="s">&quot;tag&quot;</span><span class="p">&gt;</span>

  <span class="c">&lt;!--/* (1) */--&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-center&quot;</span>
    <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;|*{totalElements} results|&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

  <span class="c">&lt;!--/* (2), (3) */--&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:if</span><span class="o">=</span><span class="s">&quot;*{totalElements} != 0&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-center&quot;</span>
    <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;|*{number + 1} / *{totalPages} Pages|&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="c">&lt;!--/* ... */--&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">検索条件に一致するデータの合計件数を表示する場合は、 <code class="docutils literal"><span class="pre">Page</span></code> オブジェクトの <code class="docutils literal"><span class="pre">totalElements</span></code> プロパティから値を取得する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">表示しているページのページ数を表示する場合は、 <code class="docutils literal"><span class="pre">Page</span></code> オブジェクトの <code class="docutils literal"><span class="pre">number</span></code> プロパティから値を取得し、<code class="docutils literal"><span class="pre">+1</span></code> する。</div>
<div class="line"><code class="docutils literal"><span class="pre">Page</span></code> オブジェクトの <code class="docutils literal"><span class="pre">number</span></code> プロパティは <code class="docutils literal"><span class="pre">0</span></code> 開始のため、 ページ番号を表示する際は <code class="docutils literal"><span class="pre">+1</span></code> が必要となる。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">検索条件に一致するデータの合計ページ数を表示する場合は、 <code class="docutils literal"><span class="pre">Page</span></code> オブジェクトの <code class="docutils literal"><span class="pre">totalPages</span></code> プロパティから値を取得する。</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line">該当ページの表示データ範囲を表示するための実装例を以下に示す。</div>
<div class="line">該当ページの表示データ範囲の表示では最大で3つの変数を用いた複雑な計算ロジックを実装することになるため式オブジェクトを用いた実装例を示す。</div>
<div class="line"><br /></div>
<div class="line">ここでは、式オブジェクトへ追加するメソッドの実装例のみを示す。式オブジェクトの登録や作成したカスタムダイアレクトの設定等については、「<a class="reference internal" href="#pagination-how-to-use-make-jsp-basic-paginationlink-link-expressionobject"><span class="std std-ref">リンクの出力範囲を計算する式オブジェクトを実装する</span></a>」を参照されたい。</div>
</div>
<ul class="simple">
<li>画面例</li>
</ul>
<blockquote>
<div><div class="figure">
<a class="reference internal image-reference" href="../../_images/pagination-how_to_use_view_pagination_info2.png"><img alt="Screen image of pagination information(begin position, end position)" src="../../_images/pagination-how_to_use_view_pagination_info2.png" style="width: 400px; height: 250px;" /></a>
</div>
</div></blockquote>
<p>「<a class="reference internal" href="#pagination-how-to-use-make-jsp-basic-paginationlink-link-expressionobject"><span class="std std-ref">リンクの出力範囲を計算する式オブジェクトを実装する</span></a>」で作成した式オブジェクトに新たにメソッドを実装する。実装例を以下に示す。</p>
<ul class="simple">
<li>式オブジェクト</li>
</ul>
<blockquote>
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">PageInfo</span> <span class="o">{</span>

    <span class="c1">// omitted</span>

    <span class="c1">// (1)</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">firstItemNumInPage</span><span class="o">(</span><span class="n">Page</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">page</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">page</span><span class="o">.</span><span class="na">getNumber</span><span class="o">()</span> <span class="o">*</span> <span class="n">page</span><span class="o">.</span><span class="na">getSize</span><span class="o">()</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// (2)</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">lastItemNumInPage</span><span class="o">(</span><span class="n">Page</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">page</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">page</span><span class="o">.</span><span class="na">getNumber</span><span class="o">()</span> <span class="o">*</span> <span class="n">page</span><span class="o">.</span><span class="na">getSize</span><span class="o">()</span> <span class="o">+</span> <span class="n">page</span><span class="o">.</span><span class="na">getNumberOfElements</span><span class="o">();</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</div>
</div></blockquote>
<table border="1" class="colwidths-given longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">Page</span></code> オブジェクトを引数に取り、 該当ページの表示データの開始位置を返すメソッドを定義する。</div>
<div class="line"><code class="docutils literal"><span class="pre">Page</span></code> オブジェクトの <code class="docutils literal"><span class="pre">number</span></code> プロパティは <code class="docutils literal"><span class="pre">0</span></code> 開始のため、データ開始位置を表示する際は <code class="docutils literal"><span class="pre">+1</span></code> が必要となる。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">Page</span></code> オブジェクトを引数に取り、 該当ページの表示データの終了位置を返すメソッドを定義する。</div>
<div class="line">最終ページは端数となる可能性があるので、 <code class="docutils literal"><span class="pre">numberOfElements</span></code> を加算する必要がある。</div>
</div>
</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>テンプレートHTML（フラグメント）</li>
</ul>
<blockquote>
<div><div class="highlight-html"><div class="highlight"><pre><span></span><span class="c">&lt;!--/* ... */--&gt;</span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:fragment</span><span class="o">=</span><span class="s">&quot;paginationInfo (page)&quot;</span> <span class="na">th:object</span><span class="o">=</span><span class="s">&quot;${page}&quot;</span> <span class="na">th:remove</span><span class="o">=</span><span class="s">&quot;tag&quot;</span><span class="p">&gt;</span>

  <span class="c">&lt;!--/* (4), (5) */--&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-center&quot;</span>
    <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;|${#pageInfo.firstItemNumInPage(page)} - ${#pageInfo.lastItemNumInPage(page)}|&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="c">&lt;!--/* ... */--&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">開始位置を式オブジェクトを使用して取得する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">終了位置を式オブジェクトを使用して取得する。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p><strong>数値のフォーマットについて</strong></p>
<p class="last">表示する数値をフォーマットする必要がある場合は、Thymeleafから提供されているユーティリティメソッド <code class="docutils literal"><span class="pre">#numbers.formatInteger()</span></code> を使用する。</p>
</div>
</div></blockquote>
<p>上記で定義したフラグメントを使用してページネーション情報を表示するテンプレートHTML（ページネーションを行う画面）の実装例は以下の通りとなる。</p>
<ul class="simple">
<li>テンプレートHTML（ページネーションを行う画面）</li>
</ul>
<blockquote>
<div><div class="highlight-html"><div class="highlight"><pre><span></span><span class="c">&lt;!--/* ... */--&gt;</span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:replace</span><span class="o">=</span><span class="s">&quot;~{pgnt/fragment :: paginationInfo (${page})}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="c">&lt;!--/* ... */--&gt;</span>
</pre></div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
</div>
<div class="section" id="appendix">
<span id="paginatin-appendix"></span><h2><a class="toc-backref" href="#id40">4.5.3. Appendix</a><a class="headerlink" href="#appendix" title="Permalink to this headline">¶</a></h2>
<div class="section" id="pageablehandlermethodargumentresolver">
<span id="paginatin-appendix-pageablehandlermethodargumentresolver"></span><h3><a class="toc-backref" href="#id41">4.5.3.1. <code class="docutils literal"><span class="pre">PageableHandlerMethodArgumentResolver</span></code> のプロパティ値について</a><a class="headerlink" href="#pageablehandlermethodargumentresolver" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">PageableHandlerMethodArgumentResolver</span></code> で指定できるプロパティは以下の通り。</div>
<div class="line">アプリケーションの要件に応じて、値を変更すること。</div>
</div>
<blockquote>
<div><table border="1" class="colwidths-given longtable docutils">
<colgroup>
<col width="10%" />
<col width="20%" />
<col width="55%" />
<col width="15%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">プロパティ名</th>
<th class="head">説明</th>
<th class="head">デフォルト値</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td>maxPageSize</td>
<td><div class="first last line-block">
<div class="line">取得件数として許可する最大値を指定する。</div>
<div class="line">指定された取得件数が <code class="docutils literal"><span class="pre">maxPageSize</span></code> を超えていた場合は、 <code class="docutils literal"><span class="pre">maxPageSize</span></code> が取得件数となる。</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><cite>2000</cite></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td>fallbackPageable</td>
<td><div class="first last line-block">
<div class="line">アプリケーション全体のページ位置、取得件数、ソート条件のデフォルト値を指定する。</div>
<div class="line">ページ位置、取得件数、ソート条件が指定されていない場合は、fallbackPageableに設定されている値が適用される。</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">ページ位置 : <cite>0</cite></div>
<div class="line">取得件数 : <cite>20</cite></div>
<div class="line">ソート条件 : <cite>null</cite></div>
</div>
</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td>oneIndexedParameters</td>
<td><div class="first last line-block">
<div class="line">ページ位置の開始値を指定する。</div>
<div class="line"><cite>false</cite> を指定した場合はページ位置の開始値は <cite>0</cite> となり、 <cite>true</cite> を指定した場合はページ位置の開始値は <cite>1</cite> となる。</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><cite>false</cite></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="4">
<li></li>
</ol>
</td>
<td>pageParameterName</td>
<td><div class="first last line-block">
<div class="line">ページ位置を指定するためのリクエストパラメータ名を指定する。</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">page</span></code></div>
</div>
</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="5">
<li></li>
</ol>
</td>
<td>sizeParameterName</td>
<td><div class="first last line-block">
<div class="line">取得件数を指定するためのリクエストパラメータ名を指定する。</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">size</span></code></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="6">
<li></li>
</ol>
</td>
<td>prefix</td>
<td><div class="first last line-block">
<div class="line">ページ位置と取得件数を指定するためのリクエストパラメータの接頭辞(ネームスペース)を指定する。</div>
<div class="line">デフォルトのパラメータ名がアプリケーションで使用するパラメータと衝突する場合は、ネームスペースを指定することでリクエストパラメータ名の衝突を防ぐことが出来る。</div>
<div class="line">prefixを指定すると、ページ位置を指定するためのリクエストパラメータ名は <code class="docutils literal"><span class="pre">prefix</span> <span class="pre">+</span> <span class="pre">pageParameterName</span></code> 、取得件数を指定するためのリクエストパラメータ名は <code class="docutils literal"><span class="pre">prefix</span> <span class="pre">+</span> <span class="pre">sizeParameterName</span></code> となる。</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">&quot;&quot;</span></code></div>
<div class="line">(ネームスペースなし)</div>
</div>
</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="7">
<li></li>
</ol>
</td>
<td>qualifierDelimiter</td>
<td><div class="first last line-block">
<div class="line">同一リクエストで複数のページ検索が必要になる場合、ページ検索に必要な情報(検索対象のページ位置、取得件数など)を区別するために、リクエストパラメータ名は <code class="docutils literal"><span class="pre">qualifier</span> <span class="pre">+</span> <span class="pre">delimiter</span> <span class="pre">+</span> <span class="pre">標準パラメータ名</span></code> の形式で指定する。</div>
<div class="line">本プロパティは、上記形式の中の <code class="docutils literal"><span class="pre">delimiter</span></code> の値を設定する。</div>
<div class="line">この設定を変更する場合は、 <code class="docutils literal"><span class="pre">SortHandlerMethodArgumentResolver</span></code> の <code class="docutils literal"><span class="pre">qualifierDelimiter</span></code> 設定も合わせて変更する必要がある。</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">“<code class="docutils literal"><span class="pre">_</span></code>”</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>maxPageSizeの設定値について</strong></p>
<p class="last">デフォルト値は <code class="docutils literal"><span class="pre">2000</span></code> であるが、アプリケーションが許容する最大値に設定を変更することを推奨する。
アプリケーションが許可する最大値が <cite>100</cite> ならば、maxPageSizeも <cite>100</cite> に設定する。</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>fallbackPageableの設定方法について</strong></p>
<p class="last">アプリケーション全体に適用するデフォルト値を変更する場合は、 <code class="docutils literal"><span class="pre">fallbackPageable</span></code> プロパティにデフォルト値が定義されている <code class="docutils literal"><span class="pre">Pageable</span></code> ( <code class="docutils literal"><span class="pre">org.springframework.data.domain.PageRequest</span></code> ) オブジェクトを設定する。
ソート条件のデフォルト値を変更する場合は、 <code class="docutils literal"><span class="pre">SortHandlerMethodArgumentResolver</span></code> の <code class="docutils literal"><span class="pre">fallbackSort</span></code> プロパティにデフォルト値が定義されている  <code class="docutils literal"><span class="pre">org.springframework.data.domain.Sort</span></code> オブジェクトを設定する。</p>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>開発するアプリケーション毎に変更が想定される以下の項目について、デフォルト値を変更する際の設定例を以下に示す。</p>
<ul class="simple">
<li>取得件数として許可する最大値( <code class="docutils literal"><span class="pre">maxPageSize</span></code> )</li>
<li>アプリケーション全体のページ位置、取得件数のデフォルト値( <code class="docutils literal"><span class="pre">fallbackPageable</span></code> )</li>
<li>ソート条件のデフォルト値( <code class="docutils literal"><span class="pre">fallbackSort</span></code> )</li>
</ul>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;mvc:annotation-driven&gt;</span>
    <span class="nt">&lt;mvc:argument-resolvers&gt;</span>
        <span class="nt">&lt;bean</span>
            <span class="na">class=</span><span class="s">&quot;org.springframework.data.web.PageableHandlerMethodArgumentResolver&quot;</span><span class="nt">&gt;</span>
            <span class="c">&lt;!-- (1) --&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;maxPageSize&quot;</span> <span class="na">value=</span><span class="s">&quot;100&quot;</span> <span class="nt">/&gt;</span>
            <span class="c">&lt;!-- (2) --&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;fallbackPageable&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;org.springframework.data.domain.PageRequest&quot;</span> <span class="na">factory-method=</span><span class="s">&quot;of&quot;</span><span class="nt">&gt;</span>
                    <span class="c">&lt;!-- (3) --&gt;</span>
                    <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;0&quot;</span> <span class="na">value=</span><span class="s">&quot;0&quot;</span> <span class="nt">/&gt;</span>
                    <span class="c">&lt;!-- (4) --&gt;</span>
                    <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;1&quot;</span> <span class="na">value=</span><span class="s">&quot;50&quot;</span> <span class="nt">/&gt;</span>
                <span class="nt">&lt;/bean&gt;</span>
            <span class="nt">&lt;/property&gt;</span>
            <span class="c">&lt;!-- (5) --&gt;</span>
            <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;0&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;org.springframework.data.web.SortHandlerMethodArgumentResolver&quot;</span><span class="nt">&gt;</span>
                    <span class="c">&lt;!-- (6) --&gt;</span>
                    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;fallbackSort&quot;</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;org.springframework.data.domain.Sort&quot;</span> <span class="na">factory-method=</span><span class="s">&quot;by&quot;</span><span class="nt">&gt;</span>
                            <span class="c">&lt;!-- (7) --&gt;</span>
                            <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;0&quot;</span><span class="nt">&gt;</span>
                                <span class="nt">&lt;list&gt;</span>
                                    <span class="c">&lt;!-- (8) --&gt;</span>
                                    <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;org.springframework.data.domain.Sort.Order&quot;</span><span class="nt">&gt;</span>
                                        <span class="c">&lt;!-- (9) --&gt;</span>
                                        <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;0&quot;</span> <span class="na">value=</span><span class="s">&quot;DESC&quot;</span> <span class="nt">/&gt;</span>
                                        <span class="c">&lt;!-- (10) --&gt;</span>
                                        <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;1&quot;</span> <span class="na">value=</span><span class="s">&quot;lastModifiedDate&quot;</span> <span class="nt">/&gt;</span>
                                    <span class="nt">&lt;/bean&gt;</span>
                                    <span class="c">&lt;!-- (8) --&gt;</span>
                                    <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;org.springframework.data.domain.Sort.Order&quot;</span><span class="nt">&gt;</span>
                                        <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;0&quot;</span> <span class="na">value=</span><span class="s">&quot;ASC&quot;</span> <span class="nt">/&gt;</span>
                                        <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;1&quot;</span> <span class="na">value=</span><span class="s">&quot;id&quot;</span> <span class="nt">/&gt;</span>
                                    <span class="nt">&lt;/bean&gt;</span>
                                <span class="nt">&lt;/list&gt;</span>
                            <span class="nt">&lt;/constructor-arg&gt;</span>
                        <span class="nt">&lt;/bean&gt;</span>
                    <span class="nt">&lt;/property&gt;</span>
                <span class="nt">&lt;/bean&gt;</span>
            <span class="nt">&lt;/constructor-arg&gt;</span>
        <span class="nt">&lt;/bean&gt;</span>
    <span class="nt">&lt;/mvc:argument-resolvers&gt;</span>
<span class="nt">&lt;/mvc:annotation-driven&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(1)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">上記例では取得件数の最大値を <cite>100</cite> に設定している。 取得件数(size)に <cite>101</cite> 以上が指定された場合は、 <cite>100</cite> に切り捨てて検索が行われる。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(2)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">org.springframework.data.domain.PageRequest</span></code> のインスタンスを生成し、 <code class="docutils literal"><span class="pre">fallbackPageable</span></code> に設定する。</div>
<div class="line">spring-data-commons 2.2.0より <code class="docutils literal"><span class="pre">PageRequest</span></code> クラスからpublicなコンストラクタが削除されたため、factory-methodを利用してstaticな <code class="docutils literal"><span class="pre">PageRequest#of</span></code> メソッドによりBeanを生成する必要がある。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(3)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">PageRequest#of</span></code> メソッドの第1引数に、ページ位置のデフォルト値を指定する。</div>
<div class="line">上記例では <cite>0</cite> を指定しているため、デフォルト値は変更していない。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(4)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">PageRequest#of</span></code> メソッドの第2引数に、取得件数のデフォルト値を指定する。</div>
<div class="line">上記例ではリクエストパラメータに取得件数の指定がない場合の取得件数は <cite>50</cite> となる。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(5)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">PageableHandlerMethodArgumentResolver</span></code> のコンストラクタとして、 <code class="docutils literal"><span class="pre">SortHandlerMethodArgumentResolver</span></code> のインスタンスを設定する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(6)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">Sort</span></code> のインスタンスを生成し、 <code class="docutils literal"><span class="pre">fallbackSort</span></code> に設定する。</div>
<div class="line">spring-data-commons 2.2.0より <code class="docutils literal"><span class="pre">Sort</span></code> クラスからpublicなコンストラクタが削除されたため、factory-methodを利用してstaticな <code class="docutils literal"><span class="pre">Sort#by</span></code> メソッドによりBeanを生成する必要がある。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(7)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">Sort#by</span></code> メソッドの第1引数に、 デフォルト値として使用する <code class="docutils literal"><span class="pre">Order</span></code> オブジェクトのリストを設定する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(8)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">Order</span></code> のインスタンスを生成し、 デフォルト値として使用する <code class="docutils literal"><span class="pre">Order</span></code> オブジェクトのリストに追加する。</div>
<div class="line">上記例ではリクエストパラメータにソート条件の指定がない場合は <code class="docutils literal"><span class="pre">ORDER</span> <span class="pre">BY</span> <span class="pre">lastModifiedDate</span> <span class="pre">DESC,</span> <span class="pre">id</span> <span class="pre">ASC</span></code> のようなOrder By句をQueryに追加することになる。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="first last line-block">
<div class="line">(9)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">Order</span></code> のコンストラクタの第1引数に、ソート順(ASC/DESC)を指定する。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line">(10)</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">Order</span></code> のコンストラクタの第2引数に、ソート項目を指定する。</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="sorthandlermethodargumentresolver">
<span id="paginatin-appendix-sorthandlermethodargumentresolver"></span><h3><a class="toc-backref" href="#id42">4.5.3.2. <code class="docutils literal"><span class="pre">SortHandlerMethodArgumentResolver</span></code> のプロパティ値について</a><a class="headerlink" href="#sorthandlermethodargumentresolver" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line"><code class="docutils literal"><span class="pre">SortHandlerMethodArgumentResolver</span></code> で指定できるプロパティは以下の通り。</div>
<div class="line">アプリケーションの要件に応じて、値を変更すること。</div>
</div>
<blockquote>
<div><table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="20%" />
<col width="55%" />
<col width="15%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">項番</th>
<th class="head">プロパティ名</th>
<th class="head">説明</th>
<th class="head">デフォルト値</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><ol class="first last arabic simple">
<li></li>
</ol>
</td>
<td>fallbackSort</td>
<td><div class="first last line-block">
<div class="line">アプリケーション全体のソート条件のデフォルト値を指定する。</div>
<div class="line">ソート条件が指定されていない場合は、fallbackSortに設定されている値が適用される。</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><cite>null</cite></div>
<div class="line">(ソート条件なし)</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="2">
<li></li>
</ol>
</td>
<td>sortParameter</td>
<td><div class="first last line-block">
<div class="line">ソート条件を指定するためのリクエストパラメータ名を指定する。</div>
<div class="line">デフォルトのパラメータ名がアプリケーションで使用するパラメータと衝突する場合は、リクエストパラメータ名を変更することで衝突を防ぐことができる。</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">sort</span></code></div>
</div>
</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="3">
<li></li>
</ol>
</td>
<td>propertyDelimiter</td>
<td><div class="first last line-block">
<div class="line">ソート項目及びソート順(ASC,DESC)の区切り文字を指定する。</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">“<code class="docutils literal"><span class="pre">,</span></code>”</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="4">
<li></li>
</ol>
</td>
<td>qualifierDelimiter</td>
<td><div class="first last line-block">
<div class="line">同一リクエストで複数のページ検索が必要になる場合、ページ検索に必要な情報(ソート条件)を区別するために、リクエストパラメータ名は <code class="docutils literal"><span class="pre">qualifier</span> <span class="pre">+</span> <span class="pre">delimiter</span> <span class="pre">+</span> <span class="pre">sortParameter</span></code> の形式で指定する。</div>
<div class="line">本プロパティは、上記形式の中の <code class="docutils literal"><span class="pre">delimiter</span></code> の値を設定する。</div>
</div>
</td>
<td><div class="first last line-block">
<div class="line">“<code class="docutils literal"><span class="pre">_</span></code>”</div>
</div>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="DoubleSubmitProtection.html" title="4.6. 二重送信防止"
             >next</a> |</li>
        <li class="right" >
          <a href="SessionManagement.html" title="4.4. セッション管理"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Macchinetta Server Framework (1.x) Development Guideline 1.8.2.RELEASE documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >4. Webアプリ開発機能</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, NTT Corporation.
      Created using <a href="https://www.sphinx-doc.org/en/master/">Sphinx</a> 1.6.2.Theme is <a href="https://pypi.org/project/solar-theme/">Solar</a>
    </div>
    
    <script>
    
    $(function() {
    	var $sidebar	= $('.sphinxsidebar'),
    		$window		= $(window),
    		offset		= $sidebar.offset(),
    		topPadding	= 3,
    		$scroll		= $('#scroll');
    	
    	$window.scroll(function() {
    		if ($scroll.is(':checked')) {
				if ($window.scrollTop() > offset.top) {
					$sidebar.stop().animate({
						marginTop:$window.scrollTop() - offset.top + topPadding
					});
				} else {
					$sidebar.stop().animate({
						marginTop:0
					});
				}
			}
		});
    	
    	var $navList = $('ul:first', $sidebar);
    	$('li:first', $navList).addClass('open');
    	
    	$navList.treeview({
    		persist: "location",
    		collapsed: true,
    		unique: false
    	});
    	
	});
    </script>
  </body>
</html>